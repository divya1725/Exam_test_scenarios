<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="b07aab40-0afd-4fb2-ab5f-705f44bbf744" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Success_BM_RFDD to APPR" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="b07aab40-0afd-4fb2-ab5f-705f44bbf744fileName">Success_BM_RFDD-to-APPR</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="groovy" name="Script_PreCondition" id="e7219be5-7400-43aa-8feb-cb6a21a1a698">
    <con:settings/>
    <con:config>
      <script>import java.text.SimpleDateFormat

def CurrentDate(){
    def date = new Date()
    sdf = new SimpleDateFormat("yyyy-MM-dd")
    return sdf.format(date)
}

def CurrentDate1(){
    def date = new Date()
    sdf = new SimpleDateFormat("yyyyMMdd")
    return sdf.format(date)
}

def RandomNumber(int X){
	def Num = ''
	for(i = 0; i &lt;X; i++){
		int A = Math.random()*10
		Num += A
	}
	return Num
}
	
//TestCaseProperty.requestedExecutionDate field = CurrentTime+timeZone----------------------------------------------------------
def CurrentTime = CurrentDate()
testRunner.testCase.setPropertyValue("requestedExecutionDate", CurrentTime+"+05:00")

log.info("ExecutedDate as "+CurrentTime+"+05:00")

//MessageIdemtification_RandomNumber---------------------------------------------------------------------------------------------------------------------------------------
def RanNum = RandomNumber(5)
def CD1=CurrentDate1()
testRunner.testCase.getTestStepByName("PreCondition").setPropertyValue("Create_messageIdentification",CD1+"MSG"+RanNum)

log.info("MessageIdentification as "+CD1+"MSG"+RanNum)

//PaymentCreate_SessionID
def RanNum1= RandomNumber(3)
testRunner.testCase.setPropertyValue("SessionID", CD1+RanNum1)

log.info("SessionID as "+CD1+RanNum1)</script>
    </con:config>
  </con:testStep>
  <con:testStep type="properties" name="PreCondition" id="4bbe497c-57f8-47d3-87b3-b542b3fc7a19">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>UserID</con:name>
          <con:value>863969697</con:value>
        </con:property>
        <con:property>
          <con:name>credentials</con:name>
          <con:value>03111012010400425kglPboRi3h16OVtVL1neI9CfuAtjCBO603eS0IgWm1WWIO7EfpSL4DE%2FlDFi69n1sSaabKNt2t%2BxJppso23a37Emmmyjbdrflpq4f56YEcTwqPbJGRxTVbEmmmyjbdrfsSaabKNt2t%2FXzlyjxYnxhcG46wcbIKp%2FsSaabKNt2t9wBUG0SyIoqFfig80Gq4uXVBtimDzTiu3EfQIWD5xMfpd8V90wfJqE%2FrpIdBWOZCg%3DWlPV5eZ4diuCWN8n8MioYhhi5y3ry7ocUG557FkHElWUtZW5y2o9bV4kNOBI2eIvhnMNNl4KZzZiP60aZOtzU6qC7h54%2FjtOS9LP2XwPBSwC3jUA00HIe25%2FFBsLnNciYlYLbkWKiTZCji3sjsSuUS8K0sIEsS3qoAJRWadlGrE%3D</con:value>
        </con:property>
        <con:property>
          <con:name>orgid</con:name>
          <con:value>4201</con:value>
        </con:property>
        <con:property>
          <con:name>Channel</con:name>
          <con:value>BES</con:value>
        </con:property>
        <con:property>
          <con:name>CustomerID</con:name>
          <con:value>863969697</con:value>
        </con:property>
        <con:property>
          <con:name>AgreementID</con:name>
          <con:value>863969697</con:value>
        </con:property>
        <con:property>
          <con:name>debtorAccount</con:name>
          <con:value>42120188040</con:value>
        </con:property>
        <con:property>
          <con:name>D_currency</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>InstructedCurrency</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>creditorAccount</con:name>
          <con:value>DE89370400440532013000</con:value>
        </con:property>
        <con:property>
          <con:name>C_bic</con:name>
          <con:value>COBADEFFXXX</con:value>
        </con:property>
        <con:property>
          <con:name>C_currency</con:name>
          <con:value>GBP</con:value>
        </con:property>
        <con:property>
          <con:name>chargeBearer</con:name>
          <con:value>SHAR</con:value>
        </con:property>
        <con:property>
          <con:name>Create_messageIdentification</con:name>
          <con:value>20200406MSG64156</con:value>
        </con:property>
        <con:property>
          <con:name>C_AgentCountry</con:name>
          <con:value>DE</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="f38a5769-646f-45cd-a0ac-faab5f9375e7" name="Authorization">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PAYSPaymentAuthorization_V1_2PortTypeSoap11</con:interface>
      <con:operation>PaymentAuthorizationCreate</con:operation>
      <con:request name="Authorization" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" wssPasswordType="" id="1d52349a-113c-40a4-a372-8b35a41bc118">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://10.246.89.107:23621/pin/services/PAYSPaymentAuthorization_V1_2Service</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pays.payment.edb.com:ws:paymentauthorization:v1_2" xmlns:urn1="urn:pays.payment.edb.com:domain:paymentauthorization:v1_2" xmlns:urn2="urn:pays.payment.edb.com:domain:authorization:v1_2" xmlns:urn3="urn:pays.payment.edb.com:domain:authorization:v1_1">
   <soapenv:Header>
        <wsc:AutHeader>
         <wsc:SourceApplication>${#TestCase#SourceApplication}</wsc:SourceApplication>
         <wsc:DestinationApplication>${#TestCase#DestinationApplication}</wsc:DestinationApplication>
         <wsc:Function>paymentAuthorizationCreate</wsc:Function>
         <wsc:Version>1.0</wsc:Version>
         <wsc:ClientContext>
            <wsc:userid>${PreCondition#UserID}</wsc:userid>
            <wsc:credentials>${PreCondition#credentials}</wsc:credentials>
            <wsc:channel>${PreCondition#Channel}</wsc:channel>
            <wsc:orgid>${PreCondition#orgid}</wsc:orgid>
            <wsc:customerid>${PreCondition#CustomerID}</wsc:customerid>
            <wsc:ip>${#TestCase#ip}</wsc:ip>
            <wsc:item key="AgreementId" value="${PreCondition#AgreementID}"/>
            <wsc:item key="PaymentChannel" value="${PreCondition#Channel}"/>
            <wsc:item key="LogRef" value="dd5dbe72-42d8-4a28-a725-5224c185545b"/>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <urn:PaymentAuthorizationCreateRequest>
        <urn:cpsAuthorizationMessage>
            <urn1:cpsUserAuthorizationData>
               <urn2:agreementData>
                  <urn3:agreementId>${PreCondition#AgreementID}</urn3:agreementId>
                  <urn3:bankId>${PreCondition#orgid}</urn3:bankId>
                  <urn3:customerID>${PreCondition#CustomerID}</urn3:customerID>
                  <urn3:productID>${PreCondition#CustomerID}</urn3:productID>
               </urn2:agreementData>
               <urn2:userId>${PreCondition#UserID}</urn2:userId>
               <urn2:sessionID>${#TestCase#SessionID}</urn2:sessionID>
               <urn2:firstName>CancelPayment</urn2:firstName>
               <urn2:lastName>AutoScript</urn2:lastName>
               <urn2:userAccount>
                  <urn2:accountNumber>${PreCondition#debtorAccount}</urn2:accountNumber>
                  <urn2:accountOwnerIdentifier>5581071</urn2:accountOwnerIdentifier>
                  <urn2:currencyCode>${PreCondition#D_currency}</urn2:currencyCode>
                  <urn2:accountType>CoreAccount</urn2:accountType>
                  <urn2:role>View</urn2:role>
                  <urn2:role>Register</urn2:role>
                  <urn2:role>Appprove</urn2:role>
                  <urn2:role>Salary</urn2:role>
                  <urn2:role>Transfer</urn2:role>
                  <urn2:approvalLimit>500000</urn2:approvalLimit>
                  <urn2:registerLimit>500000</urn2:registerLimit>
                  <urn2:numberOfVerifiers>0</urn2:numberOfVerifiers>
                  <urn2:numberOfApprovers>1</urn2:numberOfApprovers>
                  <urn2:bookingLevel>D</urn2:bookingLevel>
               </urn2:userAccount>
            </urn1:cpsUserAuthorizationData>
         </urn:cpsAuthorizationMessage>
      </urn:PaymentAuthorizationCreateRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Simple Contains" id="a89fd168-0ebb-410f-89f7-b9793a2167e5" name="Contains">
          <con:configuration>
            <token>&lt;Message>OK&lt;/Message></token>
            <ignoreCase>false</ignoreCase>
            <useRegEx>false</useRegEx>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:pays.payment.edb.com:ws:paymentauthorization:v1_2/PAYSPaymentAuthorization_V1_2PortType/PaymentAuthorizationCreateRequest"/>
        <con:wsrmConfig version="1.2"/>
        <con:environmentSpec>
          <con:entry environmentId="457af21e-28cc-497d-a733-634d703ad724">
            <con:authProfile>No Authorization</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="request" name="PaymentCreate" id="a29e3704-cac1-4d4c-bd1a-1b8d863cad21">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PINSPayment_V1_10PortTypeSoap11</con:interface>
      <con:operation>PaymentCreate</con:operation>
      <con:request name="PaymentCreate" id="1563bd10-4eb2-4dac-99b0-de1b95409024">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://10.246.89.107:23621/pin/services/PINSPayment_V1_10</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pins.payment.evry.com:ws:paymentinitiation:v1_10" xmlns:urn1="urn:pins.payment.evry.com:domain:paymentinitiation:v1_10" xmlns:urn2="urn:pins.payment.evry.com:domain:sepa-complex-types:v8" xmlns:urn3="urn:pins.payment.evry.com:domain:debtor:v1_8" xmlns:urn4="urn:pins.payment.evry.com:domain:creditor:v1_8">\r
   <soapenv:Header>\r
      <wsc:AutHeader>\r
         <wsc:SourceApplication>${#TestCase#SourceApplication}</wsc:SourceApplication>\r
         <wsc:DestinationApplication>${#TestCase#DestinationApplication}</wsc:DestinationApplication>\r
         <wsc:Function>paymentCreate</wsc:Function>\r
         <wsc:Version>1.0</wsc:Version>\r
         <wsc:ClientContext>\r
            <wsc:userid>${PreCondition#UserID}</wsc:userid>\r
            <wsc:credentials>${PreCondition#credentials}</wsc:credentials>\r
            <wsc:channel>${PreCondition#Channel}</wsc:channel>\r
            <wsc:orgid>${PreCondition#orgid}</wsc:orgid>\r
            <wsc:customerid>${PreCondition#CustomerID}</wsc:customerid>\r
            <wsc:ip>${#TestCase#ip}</wsc:ip>\r
            <wsc:item key="AgreementId" value="${PreCondition#AgreementID}"/>\r
            <wsc:item key="PaymentChannel" value="${PreCondition#Channel}"/>\r
            <wsc:item key="LogRef" value="dd5dbe72-42d8-4a28-a725-5224c185545b"/>\r
         </wsc:ClientContext>\r
      </wsc:AutHeader>\r
   </soapenv:Header>\r
   <soapenv:Body>\r
      <urn:PaymentCreateRequest>\r
         <urn:paymentMessage>\r
            <urn1:paymentIdentification>\r
               <urn2:messageIdentification>${PreCondition#Create_messageIdentification}</urn2:messageIdentification>\r
            </urn1:paymentIdentification>\r
            <urn1:paymentInfo>\r
               <urn3:paymentMethod>TRF</urn3:paymentMethod>\r
               <!--You have a CHOICE of the next 2 items at this level-->\r
               <urn3:requestedExecutionDate>${#TestCase#requestedExecutionDate}</urn3:requestedExecutionDate>\r
               <urn3:debtorAccount>\r
                  <urn2:identification>${PreCondition#debtorAccount}</urn2:identification>\r
                  <urn2:currency>${PreCondition#D_currency}</urn2:currency>\r
               </urn3:debtorAccount>\r
               <urn3:debtor>\r
                  <urn2:name>Hud beskytter</urn2:name>\r
                  <urn2:postalAddress>\r
                     <urn2:countrySubDivision>GREÅKER</urn2:countrySubDivision>\r
                     <urn2:country>NO</urn2:country>\r
                  </urn2:postalAddress>\r
               </urn3:debtor>\r
            </urn1:paymentInfo>\r
            <urn1:transaction>\r
               <urn4:amount>\r
                  <!--You have a CHOICE of the next 2 items at this level-->\r
                  <urn2:instructedAmount currency="${PreCondition#InstructedCurrency}">\r
                     <urn2:amount>1501</urn2:amount>\r
                  </urn2:instructedAmount>\r
               </urn4:amount>\r
               <!--<urn4:exchangeRateInformation>-->\r
               <!--<urn2:exchangeRate>2</urn2:exchangeRate>-->\r
               <!--<urn2:rateType>AGRD</urn2:rateType>-->\r
               <!--<urn2:contractIdentification>12344</urn2:contractIdentification>-->\r
               <!--</urn4:exchangeRateInformation>-->\r
               <urn4:chargeBearer>SHAR</urn4:chargeBearer>\r
               <urn4:creditorAgent>\r
                  <urn2:bic>${PreCondition#C_bic}</urn2:bic>\r
                  <urn2:postalAddress>\r
                     <urn2:country>DE</urn2:country>\r
                  </urn2:postalAddress>\r
               </urn4:creditorAgent>\r
               <urn4:creditor>\r
                  <urn2:name>AB07</urn2:name>\r
               </urn4:creditor>\r
               <urn4:creditorAccount>\r
                  <urn2:identification>${PreCondition#creditorAccount}</urn2:identification>\r
                  <urn2:currency>${PreCondition#C_currency}</urn2:currency>\r
               </urn4:creditorAccount>\r
               <urn4:instructionForCreditorAgent>\r
                  <!--You have a CHOICE of the next 2 items at this level-->\r
                  <urn2:code>HOLD</urn2:code>\r
                  <urn2:instructionInformation>uygiorfhwsjh</urn2:instructionInformation>\r
               </urn4:instructionForCreditorAgent>\r
               <urn1:remittanceInformationUnstructured>CancelPayment</urn1:remittanceInformationUnstructured>\r
            </urn1:transaction>\r
            <urn1:autoConfirm>false</urn1:autoConfirm>\r
         </urn:paymentMessage>\r
      </urn:PaymentCreateRequest>\r
   </soapenv:Body>\r
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Simple Contains" id="ba2a1a30-1254-4fee-a069-97a1f5893a9a" name="Contains">
          <con:configuration>
            <token>&lt;Message>OK&lt;/Message></token>
            <ignoreCase>false</ignoreCase>
            <useRegEx>false</useRegEx>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
        <con:environmentSpec>
          <con:entry environmentId="f35ece63-edfa-4db1-9e78-047bf1a1d4be">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="cf23a59a-f8a8-4220-9c70-37192ad3655d">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="216e57bb-2862-49c6-9799-dc7e750e73cc">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="457af21e-28cc-497d-a733-634d703ad724">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="Property Transfer" id="4aa220c6-94df-4033-949f-4c079f27f9aa">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>Approve_MsgID</con:name>
        <con:sourceType>Response</con:sourceType>
        <con:sourceStep>PaymentCreate</con:sourceStep>
        <con:sourcePath>declare namespace ns4='urn:pins.payment.evry.com:domain:paymentinitiation:v1_10';
declare namespace ns2='urn:pins.payment.evry.com:ws:paymentinitiation:v1_10';
//ns2:PaymentCreateResponse[1]/ns2:paymentResult[1]/ns4:messageId[1]</con:sourcePath>
        <con:targetType>Request</con:targetType>
        <con:targetStep>ApprovePayment</con:targetStep>
        <con:targetPath>declare namespace urn='urn:pays.payment.edb.com:ws:paymentstatusupdate:v1_1';
declare namespace urn1='urn:pays.payment.edb.com:domain:payment-status-update:v1_1';
//urn:PaymentApproveRequest[1]/urn:messageInput[1]/urn1:messageId[1]</con:targetPath>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>Confirm_TxId</con:name>
        <con:sourceType>Response</con:sourceType>
        <con:sourceStep>PaymentCreate</con:sourceStep>
        <con:sourcePath>declare namespace ns4='urn:pins.payment.evry.com:domain:paymentinitiation:v1_10';
declare namespace ns2='urn:pins.payment.evry.com:ws:paymentinitiation:v1_10';
//ns2:PaymentCreateResponse[1]/ns2:paymentResult[1]/ns4:transactionId[1]</con:sourcePath>
        <con:targetType>Request</con:targetType>
        <con:targetStep>ConfirmPayment</con:targetStep>
        <con:targetPath>declare namespace urn='urn:pays.payment.edb.com:ws:paymentstatusupdate:v1_1';
declare namespace urn1='urn:pays.payment.edb.com:domain:payment-status-update:v1_1';
//urn:PaymentConfirmRequest[1]/urn:transactionInput[1]/urn1:transactionId[1]</con:targetPath>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="request" name="ConfirmPayment" id="652228be-96c9-438f-b71c-a8c6b3bd3d0d">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PAYSPaymentStatusUpdate_V1_1PortTypeSoap11</con:interface>
      <con:operation>PaymentConfirm</con:operation>
      <con:request name="ConfirmPayment" id="4b504d63-6499-4348-a2a2-aff250c7baaa">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://10.246.89.107:23621/pin/services/PAYSPaymentStatusUpdate_V1_1Service</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pays.payment.edb.com:ws:paymentstatusupdate:v1_1" xmlns:urn1="urn:pays.payment.edb.com:domain:payment-status-update:v1_1">
   <soapenv:Header>
       <wsc:AutHeader>
         <wsc:SourceApplication>${#TestCase#SourceApplication}</wsc:SourceApplication>
         <wsc:DestinationApplication>${#TestCase#DestinationApplication}</wsc:DestinationApplication>
         <wsc:Function>paymentAuthorizationCreate</wsc:Function>
         <wsc:Version>1.0</wsc:Version>
         <wsc:ClientContext>
            <wsc:userid>${PreCondition#UserID}</wsc:userid>
            <wsc:credentials>${PreCondition#credentials}</wsc:credentials>
            <wsc:channel>${PreCondition#Channel}</wsc:channel>
            <wsc:orgid>${PreCondition#orgid}</wsc:orgid>
            <wsc:customerid>${PreCondition#CustomerID}</wsc:customerid>
            <wsc:ip>1.1.1.1</wsc:ip>
            <wsc:item key="AgreementId" value="${PreCondition#AgreementID}"/>
            <wsc:item key="PaymentChannel" value="${PreCondition#Channel}"/>
            <wsc:item key="LogRef" value="dd5dbe72-42d8-4a28-a725-5224c185545b"/>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <urn:PaymentConfirmRequest>
         <urn:transactionInput>
            <urn1:transactionId>54347</urn1:transactionId>
         </urn:transactionInput>
      </urn:PaymentConfirmRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Simple Contains" id="2c2ea166-7585-46e7-b697-cea11c2269ca" name="Contains">
          <con:configuration>
            <token>&lt;Message>OK&lt;/Message></token>
            <ignoreCase>false</ignoreCase>
            <useRegEx>false</useRegEx>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
        <con:environmentSpec>
          <con:entry environmentId="f35ece63-edfa-4db1-9e78-047bf1a1d4be">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="cf23a59a-f8a8-4220-9c70-37192ad3655d">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="216e57bb-2862-49c6-9799-dc7e750e73cc">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="457af21e-28cc-497d-a733-634d703ad724">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="request" name="ApprovePayment" id="79348bf7-7dff-49a0-9836-4ca0729d4733">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PAYSPaymentStatusUpdate_V1_1PortTypeSoap11</con:interface>
      <con:operation>PaymentApprove</con:operation>
      <con:request name="ApprovePayment" id="054f83d5-a071-49eb-9309-f9aae11bde1a">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://10.246.89.107:23621/pin/services/PAYSPaymentStatusUpdate_V1_1Service</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pays.payment.edb.com:ws:paymentstatusupdate:v1_1" xmlns:urn1="urn:pays.payment.edb.com:domain:payment-status-update:v1_1">
   <soapenv:Header>
      <wsc:AutHeader>
         <wsc:SourceApplication>${#TestCase#SourceApplication}</wsc:SourceApplication>
         <wsc:DestinationApplication>${#TestCase#DestinationApplication}</wsc:DestinationApplication>
         <wsc:Function>paymentCreate</wsc:Function>
         <wsc:Version>1.10</wsc:Version>
         <wsc:ClientContext>
            <wsc:userid>${PreCondition#UserID}</wsc:userid>
            <wsc:credentials>${PreCondition#credentials}</wsc:credentials>
            <wsc:channel>${PreCondition#Channel}</wsc:channel>
            <wsc:orgid>${PreCondition#orgid}</wsc:orgid>
            <wsc:customerid>${PreCondition#CustomerID}</wsc:customerid>
            <wsc:ip>${#TestCase#ip}</wsc:ip>
            <wsc:item key="PaymentChannel" value="${PreCondition#Channel}"/>
            <wsc:item key="AgreementId" value="${PreCondition#AgreementID}"/>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <urn:PaymentApproveRequest>
         <urn:messageInput>
            <urn1:messageId>34998</urn1:messageId>
         </urn:messageInput>
      </urn:PaymentApproveRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Simple Contains" id="2f0f646c-5c9d-4932-bd06-9f1da6a3c3e0" name="Contains">
          <con:configuration>
            <token>&lt;Message>OK&lt;/Message></token>
            <ignoreCase>false</ignoreCase>
            <useRegEx>false</useRegEx>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
        <con:environmentSpec>
          <con:entry environmentId="216e57bb-2862-49c6-9799-dc7e750e73cc">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="457af21e-28cc-497d-a733-634d703ad724">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="PostScript" id="f9c93b55-d50f-4657-a10e-f8db358f3169">
    <con:settings/>
    <con:config>
      <script>import java.text.SimpleDateFormat

	def CurrentDate(){
    def date = new Date()
    sdf = new SimpleDateFormat("yyyy-MM-dd")
    return sdf.format(date)
}
	
	def TransactionID = context.expand( '${PaymentCreate#Response#declare namespace ns4=\'urn:pins.payment.evry.com:domain:paymentinitiation:v1_10\'; declare namespace ns2=\'urn:pins.payment.evry.com:ws:paymentinitiation:v1_10\'; //ns2:PaymentCreateResponse[1]/ns2:paymentResult[1]/ns4:transactionId[1]}' )
	log.info(TransactionID)

	def String endpoint = context.expand( '${PaymentCreate#Endpoint}' )

	def myTestCase = testRunner.getTestCase().getLabel()

	def ProjectName= testRunner.testCase.testSuite.project.getName()

//Copy Payment ref to external data source(I.e project path\Results\PaymentRef.xml
	def Project_Path = new com.eviware.soapui.support.GroovyUtils(context).projectPath //gets the path of the project root
	File F1 = new File (Project_Path)

	FolderPath=Project_Path+"\\Result"
	File F2=new File(FolderPath)
	if  (!F2.exists())
	{
		F2.mkdir()
	}

	FilePath = FolderPath+"\\PaymentRef.xml"
	File F3=new File(FilePath)
	if  (!F3.exists())
	{
		F3.createNewFile()
	}

	F3.append("Payment Ref = "+TransactionID+" : Created on \""+CurrentDate()+"\" : "+endpoint.drop(6).take(21)+" : Project - "+ProjectName+" : TCName - "+myTestCase+"\n")</script>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>SourceApplication</con:name>
      <con:value>EVRYCPS</con:value>
    </con:property>
    <con:property>
      <con:name>DestinationApplication</con:name>
      <con:value>PINS</con:value>
    </con:property>
    <con:property>
      <con:name>ip</con:name>
      <con:value>10.235.84.79</con:value>
    </con:property>
    <con:property>
      <con:name>orgunit</con:name>
      <con:value>CORP</con:value>
    </con:property>
    <con:property>
      <con:name>requestedExecutionDate</con:name>
      <con:value>2020-04-06+05:00</con:value>
    </con:property>
    <con:property>
      <con:name>SessionID</con:name>
      <con:value>20200406588</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>9a09967f-efd7-4116-a32b-09afb9b87250</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>4d727606-c673-4243-b236-219368c0dcf8</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>e7fbfe4f-d829-4a00-ab83-7aa3fb57a6a1</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>c03fb212-1f6a-42e2-9ecb-80370a70e1cb</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>f602a1bb-1a84-4cfc-aff5-9bdf3156c635</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>2bebb8c5-ffc1-4fad-8148-c1209bce5cbb</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>78cd0640-613f-4dc8-86f5-695c595ea2a1</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>f0985c7c-7ee5-4f1b-a9da-f88cdaaeafdf</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>9254031b-86b5-4c14-80b8-925e53788598</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:environmentSpec>
    <con:entry environmentId="f35ece63-edfa-4db1-9e78-047bf1a1d4be">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
    <con:entry environmentId="216e57bb-2862-49c6-9799-dc7e750e73cc">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
</con:testCase>
