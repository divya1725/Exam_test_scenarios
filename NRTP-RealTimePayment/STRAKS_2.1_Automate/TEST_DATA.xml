<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="afa65012-c120-4e8f-a1aa-493775ab7985" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="TEST_DATA" searchProperties="true" timeout="0" disabled="true" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="afa65012-c120-4e8f-a1aa-493775ab7985fileName">TEST_DATA</con:setting>
  </con:settings>
  <con:testStep type="manualTestStep" name="TEST_DATA_SELECTION" id="0b3581f5-c2df-421c-a9b6-d135a2c131b7" disabled="true">
    <con:description>This test case is to fetch test data from PWH
	Take test data from V_AUTH_USERINFO.
	Set this data into PROPERTIES.
	Use this data across all the test cases used in the automation.

Users can also independently execute individual test cases with prior executing TEST_DATA step.</con:description>
    <con:settings/>
    <con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:expectedResult/>
    </con:config>
  </con:testStep>
  <con:testStep type="properties" name="Properties" id="2f17faa8-a4c5-4df5-bc34-c3ac3a44ac0c">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>orgid</con:name>
          <con:value>4201</con:value>
        </con:property>
        <con:property>
          <con:name>credentials</con:name>
          <con:value>03110012010400425kglPboRi3h1Z4YUjUpQ0UB65Ta2kPKj1KWwkWemtrL+SoWqMxx/KuqxUVbNyTu6DsSaabKNt2t+xJppso23a37EmmmyjbdrffJeRiGWfHDGwxCWOpDYc2jgSxAz1+8eEsSaabKNt2t/XzlyjxYnxhcG46wcbIKp/sSaabKNt2t9wBUG0SyIoqFfig80Gq4uXVBtimDzTiu2xJppso23a37Emmmyjbdrf8wP73CNrvpw=apG4tU0NraPbbqKUp39erKDFa7xy6z+r4VDMr/6qBlkFniGaNeDXv4cZcZZQQI6JtwB3JYQk6WqLA7oyp1FWRM6n46ehgNmHVNly8fTnQbIuGJSF2LUyGI7aE92/dgtp8jv9bsGpNe58K+xb4LeIHwjb2nVVvt4/2oLtDQ8IPJE=</con:value>
        </con:property>
        <con:property>
          <con:name>SourceApplication</con:name>
          <con:value>EVRYINT</con:value>
        </con:property>
        <con:property>
          <con:name>MarketType</con:name>
          <con:value>PM</con:value>
        </con:property>
        <con:property>
          <con:name>PaymentChannel</con:name>
          <con:value>INT</con:value>
        </con:property>
        <con:property>
          <con:name>SelfService</con:name>
          <con:value>true</con:value>
        </con:property>
        <con:property>
          <con:name>Employee</con:name>
          <con:value>E600685</con:value>
        </con:property>
        <con:property>
          <con:name>AgreementId</con:name>
          <con:value>19060439004</con:value>
        </con:property>
        <con:property>
          <con:name>Customerid</con:name>
          <con:value>19060439004</con:value>
        </con:property>
        <con:property>
          <con:name>Userid</con:name>
          <con:value>19060439004</con:value>
        </con:property>
        <con:property>
          <con:name>DebitAccount</con:name>
          <con:value>44400268506</con:value>
        </con:property>
        <con:property>
          <con:name>DebitAcntCcy</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>DebtorAgentBic</con:name>
          <con:value>SPTRNO22XXX</con:value>
        </con:property>
        <con:property>
          <con:name>InstrAmount</con:name>
          <con:value>0.19</con:value>
        </con:property>
        <con:property>
          <con:name>CreditAccount</con:name>
          <con:value>42021430581</con:value>
        </con:property>
        <con:property>
          <con:name>LogRef</con:name>
          <con:value>${= java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern('dMMyyHHmmss'))}</con:value>
        </con:property>
        <con:property>
          <con:name>ReqExnDate</con:name>
          <con:value>${= java.time.LocalDate.now()}</con:value>
        </con:property>
        <con:property>
          <con:name>paymentcontext</con:name>
          <con:value>{"items":{"PaymentChannel":"ITR","SelfService":"false","LogRef":"${Properties#LogRef}"}}</con:value>
        </con:property>
        <con:property>
          <con:name>USERSESSION</con:name>
          <con:value>{"authLevel":"2", "bankOrgID":"${Properties#orgid}", "client":{"ip":"127.0.0.1","userAgent":"soapUI"}, "sessionID":"ipY-R_OLbu50WpfCfQKOCO_", "userID":"${Properties#Employee}"}</con:value>
        </con:property>
        <con:property>
          <con:name>SECURITYTOKEN</con:name>
          <con:value>{"tokenType": "EvrySo", "token": "${Properties#credentials}"}</con:value>
        </con:property>
        <con:property>
          <con:name>TppId</con:name>
          <con:value>PSDNO-FSA-918713867</con:value>
        </con:property>
        <con:property>
          <con:name>TppName</con:name>
          <con:value>VIPPS AS</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="PWH V_AUTH_USERINFO_NOK" id="23d261a4-fa64-4f1e-9cab-fc5b3490829e">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWHDATA</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:pwhdata/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d2)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>SELECT USERID,ACCOUNTNUMBER,CURRENCYCODE
FROM V_AUTH_USERINFO WHERE
BANKORGID='${Properties#orgid}'
AND MARKETTYPE='${Properties#MarketType}'
AND CHANNEL = '${Properties#PaymentChannel}'
FETCH FIRST 1 ROWS ONLY</con:query>
      <con:assertion type="JDBC Status" id="266efb75-b6f0-4041-abb8-b71379cf3d0a" name="JDBC Status"/>
      <con:assertion type="DataAndMetadataAssertion" id="9c8147b5-ba49-4fd1-9e88-7d5fff08e637" name="Smart Assertion">
        <con:configuration xsi:type="con:DataAndMetadataAssertion">
          <con:mode>Received Data</con:mode>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/@fetchSize</con:path>
            <con:element>@fetchSize</con:element>
            <con:operatorId>8</con:operatorId>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>true</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/@rowNumber</con:path>
            <con:element>@rowNumber</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/USERID[1]</con:path>
            <con:element>USERID</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>19054210828</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTNUMBER[1]</con:path>
            <con:element>ACCOUNTNUMBER</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>42024493606</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTTYPENAME[1]</con:path>
            <con:element>ACCOUNTTYPENAME</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>CoreAccount</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/CURRENCYCODE[1]</con:path>
            <con:element>CURRENCYCODE</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>NOK</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTROLENAME[1]</con:path>
            <con:element>ACCOUNTROLENAME</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Register</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage><![CDATA[<Results>
   <ResultSet fetchSize="10">
      <Row rowNumber="1">
         <USERID>19054210828</USERID>
         <ACCOUNTNUMBER>42024493606</ACCOUNTNUMBER>
         <ACCOUNTTYPENAME>CoreAccount</ACCOUNTTYPENAME>
         <CURRENCYCODE>NOK</CURRENCYCODE>
         <ACCOUNTROLENAME>Register</ACCOUNTROLENAME>
      </Row>
   </ResultSet>
</Results>]]></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="SET_TEST_DATA" id="f7e21a9b-fecb-42d7-add7-d928addcebc6">
    <con:settings/>
    <con:config>
      <script>String userid = context.expand( '${PWH V_AUTH_USERINFO_NOK#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/USERID[1]}' );
String account = context.expand( '${PWH V_AUTH_USERINFO_NOK#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/ACCOUNTNUMBER[1]}' );
String currency = context.expand( '${PWH V_AUTH_USERINFO_NOK#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/CURRENCYCODE[1]}' );

userid= userid.toString().replaceAll("[^a-zA-Z0-9]+","");
account= account.toString().replaceAll("[^a-zA-Z0-9]+","");
currency= currency.toString().replaceAll("[^a-zA-Z0-9]+","");

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Customerid",userid);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Userid",userid);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("AgreementId",userid);

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("DebitAccount",account);

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("DebitAcntCcy",currency);</script>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:environmentSpec>
    <con:entry environmentId="91fc5bbb-38af-4ede-9346-db374adc1e5a">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
</con:testCase>
