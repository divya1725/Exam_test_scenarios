<?xml version="1.0" encoding="UTF-8"?>
<con:testCase timeout="0" searchProperties="true" name="Auth" keepSession="false" id="026eb381-1adf-471c-8f03-018b8b81b459" failTestCaseOnErrors="true" failOnError="true" discardOkResults="false" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="959d3d75-40dd-40b2-9e89-5fb6748ffb22fileName">Auth</con:setting>
    <con:setting id="026eb381-1adf-471c-8f03-018b8b81b459fileName">Auth</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="request" name="Authorisation_v1_3" id="a05ec267-893f-4591-9559-6079042b1a6f">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PINSPaymentAuthorization_V1_3PortTypeSoap11</con:interface>
      <con:operation>PaymentAuthorizationCreate</con:operation>
      <con:request wssPasswordType="" useWsReliableMessaging="false" useWsAddressing="false" timeout="" sslKeystore="" outgoingWss="" name="Authorisation_v1_3" incomingWss="" id="844e414c-ba86-4bd6-b688-8a525d69251b">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://${#Project#G_D10}/pin/services/PINSPaymentAuthorization_V1_3</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pins.payment.evry.com:ws:paymentauthorization:v1_3" xmlns:urn1="urn:pins.payment.evry.com:domain:paymentauthorization:v1_3" xmlns:urn2="urn:pins.payment.evry.com:domain:authorization:v1_3">
   <soapenv:Header>
      <wsc:AutHeader>
         <wsc:SourceApplication>${#TestSuite#SourceApplication}</wsc:SourceApplication>
         <wsc:DestinationApplication>PIN</wsc:DestinationApplication>
         <wsc:Function>PIN Create</wsc:Function>
         <wsc:Version>V2.0</wsc:Version>
         <wsc:ClientContext>
            <wsc:userid>${#TestSuite#userid}</wsc:userid>
            <wsc:credentials>${#TestSuite#credentials}</wsc:credentials>
            <wsc:channel>NBA</wsc:channel>
            <wsc:orgid>${#TestSuite#orgid}</wsc:orgid>
            <wsc:orgunit>${#TestSuite#orgid}</wsc:orgunit>
            <wsc:customerid>${#TestSuite#customerid}</wsc:customerid>
            <wsc:locale>en</wsc:locale>
            <wsc:ip>1.1.1.1</wsc:ip>
            <wsc:item value="${#TestSuite#value1}" key="${#TestSuite#item1}"/>
            <wsc:item value="${#TestSuite#value2}" key="${#TestSuite#item2}"/>
            <wsc:item value="${#TestSuite#value3}" key="${#TestSuite#item3}"/>
            <wsc:item value="${#TestSuite#value4}" key="${#TestSuite#item4}"/>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <urn:PaymentAuthorizationCreateRequest>
         <urn:cpsAuthorizationMessage>
            <urn1:cpsUserAuthorizationData>
               <urn2:agreementData>
                  <urn2:agreementId>${#TestSuite#value2}</urn2:agreementId>
                  <!--Optional:-->
                  <urn2:bankId>${#TestSuite#orgid}</urn2:bankId>
                  <urn2:customerID>${#TestSuite#customerid}</urn2:customerID>
                  <urn2:productID>123423</urn2:productID>
                  <!--Optional:-->
                  <!--1 or more repetitions:-->
                  <urn2:migrationDate>2020-08-02+05:00</urn2:migrationDate>
                  <urn2:corporateGrouping>
                     <urn2:customerId>${#TestSuite#customerid}</urn2:customerId>
                     <urn2:agreementId>${#TestSuite#value2}</urn2:agreementId>
                     <!--Optional:-->
                     <urn2:b2bPollingEnabled>false</urn2:b2bPollingEnabled>
                  </urn2:corporateGrouping>
                  <!--Zero or more repetitions:-->
                  <urn2:agreementAccount>
                     <urn2:accountNumber>${#TestSuite#debitAccount}</urn2:accountNumber>
                     <urn2:accountOwnerIdentifier>${#TestSuite#customerid}</urn2:accountOwnerIdentifier>
                     <!--Optional:-->
                     <urn2:currencyCode>${#TestSuite#debitAcntccy}</urn2:currencyCode>
                     <urn2:accountType>CoreAccount</urn2:accountType>
                     <urn2:numberOfVerifiers>0</urn2:numberOfVerifiers>
                     <urn2:numberOfApprovers>1</urn2:numberOfApprovers>
                     <!--Optional:-->
                     <urn2:access>CREDIT_AND_DEBIT</urn2:access>
                  </urn2:agreementAccount>
               </urn2:agreementData>
               <urn2:userData>
                  <urn2:userId>${#TestSuite#userid}</urn2:userId>
                  <!--Optional:-->
                  <urn2:sessionID>123</urn2:sessionID>
                  <urn2:firstName>firstName</urn2:firstName>
                  <urn2:lastName>lastName</urn2:lastName>
                  <!--Optional:-->
                  <urn2:socialSecurityNumber>${#TestSuite#customerid}</urn2:socialSecurityNumber>
                  <!--Zero or more repetitions:-->
                  <urn2:userAccount>
                     <urn2:accountNumber>${#TestSuite#debitAccount}</urn2:accountNumber>
                     <!--Optional:-->
                     <!--Zero or more repetitions:-->
                     <!--Optional:-->
                     <urn2:role>View</urn2:role>
                     <urn2:role>Register</urn2:role>
                     <urn2:role>Appprove</urn2:role>
                     <urn2:role>Salary</urn2:role>
                     <urn2:role>Transfer</urn2:role>
                     <urn2:bookingLevel>D</urn2:bookingLevel>
                     <urn2:approvalLimit>999999</urn2:approvalLimit>
                     <urn2:registerLimit>999999</urn2:registerLimit>
                  </urn2:userAccount>
                  <!--Zero or more repetitions:-->
               </urn2:userData>
            </urn1:cpsUserAuthorizationData>
         </urn:cpsAuthorizationMessage>
      </urn:PaymentAuthorizationCreateRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Schema Compliance" name="Schema Compliance" id="32d275d6-62b1-466a-b55e-73971ebdf058">
          <con:configuration/>
        </con:assertion>
        <con:assertion type="XPath Match" name="Match content of [ErrorCode]" id="60d840da-e3b0-467a-b466-da711d608d33">
          <con:configuration>
            <path>${#Response#//*:ErrorCode}</path>
            <content>0</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:assertion type="GroovyScriptAssertion" name="writeToFile" id="978b2890-9d6a-4440-9718-ea4053aba376">
          <con:configuration>
            <scriptText>import com.eviware.soapui.support.XmlHolder
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.TimeZone;

def path=context.expand( '${projectDir}')
String curStepName = (String)context.getCurrentStep().getLabel()

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context ) 
def response = groovyUtils.getXmlHolder(curStepName + "#Response")
def errorCode=response.getNodeValue("//*:ErrorCode");
def testCase = context.getCurrentStep().getTestCase().getLabel()
def endPoint = messageExchange.getEndpoint()

path=path+"\\results"
File dir = new File(path);
if (!dir.exists())
{
                log.info 'Creating Directory'
                dir.mkdir();
}

Date date = new Date();
SimpleDateFormat df = new SimpleDateFormat("dd-M-yyyy hh:mm:ss a zz");    
df.setTimeZone(TimeZone.getTimeZone("Europe/Oslo"));

def datetime = df.format(date)

SimpleDateFormat fn = new SimpleDateFormat("dd-M-yyyy hh_mm_ss a zz");    
def fileName = fn.format(date)

//log.info path 
def fout = new File(path+"\\"+testCase+" - "+curStepName+"_"+fileName+"_"+errorCode+".txt",)


fout.write("Time Submitted		:	"+datetime+"\r\n")
fout.append("End Point Used		:	"+endPoint+"\r\n")
fout.append("Time Taken		:	"+messageExchange.timeTaken+"ms\r\n")
fout.append("Executed in test set	:	"+testCase+" - "+curStepName+"_"+fileName)
fout.append("=========================================================================================================================\r\n","UTF-8")
fout.append("                                                                                                   REQUEST\r\n\r\n","UTF-8")
fout.append(messageExchange.getRequestHeaders())
fout.append("\n\n")
fout.append(new String( messageExchange.getRequestContent() ).replace("\n","\r\n"),"UTF-8")
fout.append("\r\n\r\n","UTF-8")
fout.append("=========================================================================================================================\r\n","UTF-8")
fout.append("                                                                                                   RESPONSE\r\n\r\n","UTF-8")
fout.append(messageExchange.getResponseHeaders())
fout.append("\n\n")
fout.append(new String( messageExchange.getResponseContent() ).replace("\n","\n"),"UTF-8")
fout.append("\r\n\r\n","UTF-8")
fout.append("=========================================================================================================================\r\n","UTF-8")</scriptText>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig version="200508" mustUnderstand="NONE" action="urn:pins.payment.evry.com:ws:paymentauthorization:v1_3/PINSPaymentAuthorization_V1_3PortType/PaymentAuthorizationCreateRequest"/>
        <con:wsrmConfig version="1.2"/>
      </con:request>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>3c983f65-aebb-44fc-8d78-aece89cef930</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
