<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="24d8adf1-b14d-43ad-8bd9-6532899db497" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Bank User tries SO SEARCH with Customer Id" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:description>Verifies Inspection Log when Inspection logging is SUCCESSFULL when SO SEARCH with CUSTOMER ID</con:description>
  <con:settings>
    <con:setting id="24d8adf1-b14d-43ad-8bd9-6532899db497fileName">Bank-User-tries-SO-SEARCH-with-Customer-Id</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="properties" name="Properties" id="3de5dd97-482d-4633-bffa-4c976c09db42">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>SourceApplication</con:name>
          <con:value>PaymentClient</con:value>
        </con:property>
        <con:property>
          <con:name>UserID</con:name>
          <con:value>e212927</con:value>
        </con:property>
        <con:property>
          <con:name>credentials</con:name>
          <con:value>03110012010400425kglPboRi3h1Z4YUjUpQ0UB65Ta2kPKj1KWwkWemtrL+SoWqMxx/KuqxUVbNyTu6DsSaabKNt2t+xJppso23a37EmmmyjbdrffJeRiGWfHDGwxCWOpDYc2jgSxAz1+8eEsSaabKNt2t/XzlyjxYnxhcG46wcbIKp/sSaabKNt2t9wBUG0SyIoqFfig80Gq4uXVBtimDzTiu2xJppso23a37Emmmyjbdrf8wP73CNrvpw=apG4tU0NraPbbqKUp39erKDFa7xy6z+r4VDMr/6qBlkFniGaNeDXv4cZcZZQQI6JtwB3JYQk6WqLA7oyp1FWRM6n46ehgNmHVNly8fTnQbIuGJSF2LUyGI7aE92/dgtp8jv9bsGpNe58K+xb4LeIHwjb2nVVvt4/2oLtDQ8IPJE=</con:value>
        </con:property>
        <con:property>
          <con:name>channel</con:name>
          <con:value>NBA</con:value>
        </con:property>
        <con:property>
          <con:name>orgid</con:name>
          <con:value>4201</con:value>
        </con:property>
        <con:property>
          <con:name>customerid</con:name>
          <con:value>02019105000</con:value>
        </con:property>
        <con:property>
          <con:name>item1</con:name>
          <con:value>PaymentChannel</con:value>
        </con:property>
        <con:property>
          <con:name>value1</con:name>
          <con:value>ITR</con:value>
        </con:property>
        <con:property>
          <con:name>item2</con:name>
          <con:value>LogRef</con:value>
        </con:property>
        <con:property>
          <con:name>value2</con:name>
          <con:value>${= CommonLibrary.getNorwayTime('HHmm')}</con:value>
        </con:property>
        <con:property>
          <con:name>item3</con:name>
          <con:value>AgreementId</con:value>
        </con:property>
        <con:property>
          <con:name>value3</con:name>
          <con:value>${Properties#customerid}</con:value>
        </con:property>
        <con:property>
          <con:name>item4</con:name>
          <con:value>Employee</con:value>
        </con:property>
        <con:property>
          <con:name>value4</con:name>
          <con:value>${Properties#UserID}</con:value>
        </con:property>
        <con:property>
          <con:name>item5</con:name>
          <con:value>SelfService</con:value>
        </con:property>
        <con:property>
          <con:name>value5</con:name>
          <con:value>false</con:value>
        </con:property>
        <con:property>
          <con:name>ReqExnDate</con:name>
          <con:value>${=CommonLibrary.getDate(1,'yyyy-MM-dd')}</con:value>
        </con:property>
        <con:property>
          <con:name>accountNumber</con:name>
          <con:value>96500233181</con:value>
        </con:property>
        <con:property>
          <con:name>currencyCode</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>CreditorAgent</con:name>
          <con:value>SPTRNO22XXX</con:value>
        </con:property>
        <con:property>
          <con:name>CreditorCountry</con:name>
          <con:value>NO</con:value>
        </con:property>
        <con:property>
          <con:name>CreditorCurrency</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>CreditAccountNumber</con:name>
          <con:value xsi:nil="true"/>
        </con:property>
        <con:property>
          <con:name>Amount</con:name>
          <con:value>20</con:value>
        </con:property>
        <con:property>
          <con:name>AgreementId</con:name>
          <con:value>${Properties#customerid}</con:value>
        </con:property>
        <con:property>
          <con:name>messageId</con:name>
          <con:value>1294811</con:value>
        </con:property>
        <con:property>
          <con:name>transactionId</con:name>
          <con:value>261242095</con:value>
        </con:property>
        <con:property>
          <con:name>paymentinfoId</con:name>
          <con:value>1427393</con:value>
        </con:property>
        <con:property>
          <con:name>paymentReference</con:name>
          <con:value>261242095</con:value>
        </con:property>
        <con:property>
          <con:name>LogRef</con:name>
          <con:value>1417</con:value>
        </con:property>
        <con:property>
          <con:name>serviceFunction</con:name>
          <con:value>standingOrderSearch</con:value>
        </con:property>
        <con:property>
          <con:name>serviceDescription</con:name>
          <con:value>list/read standing order</con:value>
        </con:property>
        <con:property>
          <con:name>GrepString</con:name>
          <con:value>grep -i -E '4201.*02019105000.*96500233181.*EVRY.*PCL.*e212927.*standingOrderSearch.*list/read standing order' inspection.log | tail -1</con:value>
        </con:property>
        <con:property>
          <con:name>InspectionLog</con:name>
          <con:value><![CDATA[<AccessLogRecord><InstitutionID>4201</InstitutionID><CustomerID>02019105000</CustomerID><AccountID>96500233181</AccountID><Source>EVRY</Source><System>PCL</System><UserID>e212927</UserID><Function>standingOrderSearch</Function><DateTime>20220426141703</DateTime><Description>list/read standing order</Description></AccessLogRecord>]]></con:value>
        </con:property>
        <con:property>
          <con:name>InspectionSource</con:name>
          <con:value>EVRY</con:value>
        </con:property>
        <con:property>
          <con:name>InspectionSystem</con:name>
          <con:value>PCL</con:value>
        </con:property>
        <con:property>
          <con:name>SOAgreementID</con:name>
          <con:value>80134</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="Fetch Active Payments" id="eda70af7-ee89-4db0-941e-431d9f31abf9">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_s1_19c)))</con:connectionString>
      <con:password>sad</con:password>
      <con:connectionProperties/>
      <con:query>select C.TRANSACTIONSID,C.PAYMENT_REF,B.PAYMENTINFOID,A.MESSAGEID,A.CUSTOMERID,C.DEBETACCOUNTNO,C.PAYMENTTYPE,C.PAYMENTSTATUS,C.INITIATORBANKID, C.DEBITAMOUNTCCY, C.AGREEMENTID
from MESSAGE A,PAYMENTINFO B, TRANSACTIONS C where 
A.MESSAGEID = B.FK_MESSAGEID and B.PAYMENTINFOID = C.FK_PAYMENTINFOID and 
C.PAYMENTSTATUS != 'COMP' and C.AGREEMENTID is not null
and C.INITIATORBANKID = '4201'  order by C.TRANSACTIONSID  desc fetch first row only</con:query>
      <con:assertion type="JDBC Status" id="6328a988-1e28-4718-9a78-4d0a3da788a3" name="JDBC Status"/>
      <con:assertion type="JDBC Timeout" id="ecafa508-a52a-401d-9178-43a33b9ecdb6" name="JDBC Timeout"/>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="dataTransfer" id="fa6024e7-48da-4c4a-8555-0f74ce278d03">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>transactionId</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/TRANSACTIONSID[1]</con:sourcePath>
        <con:targetType>transactionId</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:targetPath/>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>messageId</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/MESSAGEID[1]</con:sourcePath>
        <con:targetType>messageId</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>paymentInfoId</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/PAYMENTINFOID[1]</con:sourcePath>
        <con:targetType>paymentinfoId</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>accountNum</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/DEBETACCOUNTNO[1]</con:sourcePath>
        <con:targetType>accountNumber</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>customerId</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/CUSTOMERID[1]</con:sourcePath>
        <con:targetType>customerid</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>currency</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/DEBITAMOUNTCCY[1]</con:sourcePath>
        <con:targetType>currencyCode</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>paymentRef</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/PAYMENT_REF[1]</con:sourcePath>
        <con:targetType>paymentReference</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>creditAccount</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/OTHER_ID[1]</con:sourcePath>
        <con:targetType>CreditAccountNumber</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>SOAgrmntId</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>Fetch Active Payments</con:sourceStep>
        <con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/AGREEMENTID[1]</con:sourcePath>
        <con:targetType>SOAgreementID</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="695d953c-0555-4985-a6fc-fc44cd8a0a12" name="StandingOrderSearch_V_2_0">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PINSStandingOrder_V2_0ServicePortTypeSoap11</con:interface>
      <con:operation>standingOrderSearch</con:operation>
      <con:request name="StandingOrderSearch_V_2_0" id="4adb57e9-76ed-4366-9ba6-e3f57285be0a">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://10.246.89.107:23621/pin/services/PINSStandingOrder_V2_0Service</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v22" xmlns:urn="urn:srv.stord.fs.evry.com:ws:standingorder:v2_0" xmlns:urn1="urn:srv.stord.fs.evry.com:domain:standingorder:v2_0" xmlns:urn2="urn:pins.payment.evry.com:domain:common:v2_0">\r
   <soapenv:Header>\r
      <wsc:AutHeader>\r
         <wsc:SourceApplication>${Properties#SourceApplication}</wsc:SourceApplication>\r
         <wsc:DestinationApplication>PAYS</wsc:DestinationApplication>\r
         <wsc:Function>paymentAuthorizationCreate</wsc:Function>\r
         <wsc:Version>1.0</wsc:Version>\r
         <wsc:ClientContext>\r
            <wsc:userid>${Properties#UserID}</wsc:userid>\r
            <wsc:credentials>${Properties#credentials}</wsc:credentials>\r
            <wsc:channel>${Properties#channel}</wsc:channel>\r
            <wsc:orgid>${Properties#orgid}</wsc:orgid>\r
            <!--Optional:-->\r
            <wsc:orgunit xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>\r
            <!--Optional:-->\r
            <wsc:customerid>${Properties#customerid}</wsc:customerid>\r
            <!--Optional:-->\r
            <wsc:locale xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>\r
            <wsc:ip>1.1.1.1</wsc:ip>\r
            <!--Zero or more repetitions:-->\r
            <wsc:item key="${Properties#item1}" value="${Properties#value1}"/>\r
            <wsc:item key="${Properties#item2}" value="${Properties#value2}"/>\r
            <wsc:item key="${Properties#item4}" value="${Properties#value4}"/>\r
            <wsc:item key="${Properties#item5}" value="${Properties#value5}"/>\r
         </wsc:ClientContext>\r
      </wsc:AutHeader>\r
   </soapenv:Header>\r
   <soapenv:Body>\r
      <urn:standingOrderSearchRequest>\r
         <urn:standingOrderSearch>\r
            <urn:searchCriteria>\r
               <!--Optional:-->\r
               <!--Optional:-->\r
               <!--Optional:-->\r
               <!--Zero or more repetitions:-->\r
               <!--Zero or more repetitions:-->\r
               <!--Optional:-->\r
               <!--Optional:-->\r
               <urn1:customerId>${Properties#customerid}</urn1:customerId>\r
               <urn1:bankEmployeeInitiated>false</urn1:bankEmployeeInitiated>\r
               <!--Optional:-->\r
               <urn1:filterByOrgUnit>false</urn1:filterByOrgUnit>\r
            </urn:searchCriteria>\r
            <urn:pagingElement>\r
               <urn2:startIndex>0</urn2:startIndex>\r
               <urn2:pageSize>10</urn2:pageSize>\r
            </urn:pagingElement>\r
         </urn:standingOrderSearch>\r
      </urn:standingOrderSearchRequest>\r
   </soapenv:Body>\r
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Valid HTTP Status Codes" id="f3bc878f-962e-4da6-a0a9-b5b219404ff1" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="SOAP Fault Assertion" id="4c3d69cf-89d6-4928-a3a7-159b2a2820a2" name="Not SOAP Fault"/>
        <con:assertion type="Schema Compliance" id="cfde43aa-a457-45c7-be90-f19dddf18e2c" name="Schema Compliance">
          <con:configuration/>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig action="urn:srv.stord.fs.evry.com:ws:standingorder:v2_0/PINSStandingOrder_V2_0ServicePortType/standingOrderSearchRequest" mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="logRefTransfer" id="38828cb4-4f4d-4c38-9b98-dc39119e5728">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>logRef</con:name>
        <con:sourceType>RawRequest</con:sourceType>
        <con:sourceStep>StandingOrderSearch_V_2_0</con:sourceStep>
        <con:sourcePath>declare namespace wsc='http://edb.com/ws/WSCommon_v22';
//wsc:AutHeader[1]/wsc:ClientContext[1]/wsc:item[2]/@value</con:sourcePath>
        <con:targetType>LogRef</con:targetType>
        <con:targetStep>Properties</con:targetStep>
        <con:targetPath/>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="WaitForInspectionLog" id="62dbb841-da8e-4ccd-bd07-651eeecd47db">
    <con:settings/>
    <con:config>
      <delay>${#TestSuite#waitForLog}</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="CreateGrepString" id="c1bedd13-550e-465d-b5d4-5c5da827dcff">
    <con:settings/>
    <con:config>
      <script>def orgid = context.expand( '${Properties#orgid}' )
def customerid = context.expand( '${Properties#customerid}' )
def firstZeros = customerid.substring(0,2)
if (firstZeros=="00") customerid = Integer.parseInt(customerid)
def accountNumber = context.expand( '${Properties#accountNumber}' )
//def creditAccountNumber = context.expand( '${Properties#CreditAccountNumber}' )

def userID = context.expand( '${Properties#UserID}' )
def serviceFunction = context.expand( '${Properties#serviceFunction}' )
def serviceDescription = context.expand( '${Properties#serviceDescription}' )
def inspectionSource = context.expand( '${Properties#InspectionSource}' )
def inspectionSystem = context.expand( '${Properties#InspectionSystem}' )
def logRef = context.expand( '${Properties#LogRef}' )

try{System.sleep(200)}catch(Exception ex){}
def nextTime = CommonLibrary.getNextTime(logRef)
try{System.sleep(200)}catch(Exception ex){}

def accountNumberTemp = context.expand( '${StandingOrderSearch_V_2_0#Response#declare namespace ns4=\'urn:srv.stord.fs.evry.com:domain:debtor:v2_0\'; declare namespace ns6=\'urn:srv.stord.fs.evry.com:ws:standingorder:v2_0\'; declare namespace ns3=\'urn:pins.payment.evry.com:domain:complex-types:v2_0\'; declare namespace ns2=\'urn:srv.stord.fs.evry.com:domain:standingorder:v2_0\'; //ns6:standingOrderSearchResponse[1]/ns6:standingOrders[1]/ns2:paymentInfo[1]/ns4:debtorAccount[1]/ns3:identification[1]}' )
accountNumber = accountNumberTemp
if (accountNumberTemp == "") accountNumber =""

def grepString = "grep -i -E '${orgid}.*${customerid}.*${accountNumber}.*${inspectionSource}.*${inspectionSystem}.*${userID}.*${serviceFunction}.*${serviceDescription}' inspection.log | tail -1"
log.info "Grep String:" + grepString
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("GrepString", grepString)</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Fetch Inspection Log" id="35d6bd05-403d-47db-92d7-310f2ee98b3e">
    <con:settings/>
    <con:config>
      <script>import groovy.json.JsonSlurper

def strHost = context.expand( '${#Project#EOSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )

def env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.substring(2)
def strFileDirectory = '/eos/' + env + '/pin/i1/logs/pin'

def strLogRef = context.expand( '${Properties#LogRef}' )
 
if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

def grepString = context.expand( '${Properties#GrepString}' )
 grepString = 'cd ' + strFileDirectory + ';' + grepString

def InspectionLog = ServerConnect.execCommand(grepString)
log.info "InspectionLog is :" + InspectionLog
ServerConnect.closeConnection()

assert InspectionLog.trim() != "", "Inspection log not found in Inspection.log!!, Grep Command:" + grepString

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("InspectionLog", InspectionLog)</script>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>232997f6-864f-4682-951a-6904fd2d89ec</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>367a09f7-5ca2-4453-982f-0222345a48b3</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>236b4125-d511-4402-a4ee-74e12c5ecbb4</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>ba3188b6-5bad-4c55-bed0-a5a82a0303c6</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>98becb02-8c3c-4186-96b8-f165b9a4523e</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>695d953c-0555-4985-a6fc-fc44cd8a0a12</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
