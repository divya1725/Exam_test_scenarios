<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="4e71a359-ce65-40a7-9a26-cad69ff7dece" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="AgreementUpdateOwner" searchProperties="true" timeout="0" disabled="true" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="4e71a359-ce65-40a7-9a26-cad69ff7decefileName">AgreementUpdateOwner</con:setting>
  </con:settings>
  <con:testStep type="properties" name="Properties" id="67bcc1a3-4505-4cc2-b28c-61d230ca5179">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>messageType</con:name>
          <con:value>AgreementUpdateOwner</con:value>
        </con:property>
        <con:property>
          <con:name>orgId</con:name>
          <con:value>3240</con:value>
        </con:property>
        <con:property>
          <con:name>customerNumber</con:name>
          <con:value>19095908309</con:value>
        </con:property>
        <con:property>
          <con:name>customerIntId</con:name>
          <con:value>82898311000</con:value>
        </con:property>
        <con:property>
          <con:name>accountNumber</con:name>
          <con:value>32400414598</con:value>
        </con:property>
        <con:property>
          <con:name>IBAN</con:name>
          <con:value>NO5232400414598</con:value>
        </con:property>
        <con:property>
          <con:name>template_message</con:name>
          <con:value><![CDATA[<?xml version="1.0"?><notify_subscriber sender="EVRY"><messageType>${Properties#messageType}</messageType><productType>CASA</productType><versionNo>2</versionNo><sourceApplication>AGR</sourceApplication><functionId>KFCDN</functionId><orgId>${Properties#orgId}</orgId><financeInstituteId>423883334365999458</financeInstituteId><batchMassUpdating>${Properties#orgId}</batchMassUpdating><userId>Z2714AR</userId><systemDate>2021-01-07</systemDate><dateTime>2021-01-07T15:51:38</dateTime><originatingSourceApplication>INTERNALIAG</originatingSourceApplication><messageTypeDataString><keyFields><customerNumber>${Properties#customerNumber}</customerNumber><customerIntId>${Properties#customerIntId}</customerIntId><accountNumber>${Properties#accountNumber}</accountNumber><IBAN>${Properties#IBAN}</IBAN></keyFields><supplementaryDataString><productType>CASA</productType><productIntId>977862086120016278</productIntId><agreementValidFromDate>2022-08-04</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate><agreementOld><agreementIntId>279196109761784856</agreementIntId><customerIntId>${Properties#customerIntId}</customerIntId><endDate>2022-08-04</endDate><endTime>09:10:34</endTime></agreementOld><agreementNew><agreementIntId>281287267411164675</agreementIntId><customerIntId>${Properties#customerIntId}</customerIntId><agreementValidFromDate>2022-08-04</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate><transactionLogTs/></agreementNew></supplementaryDataString></messageTypeDataString></notify_subscriber>]]></con:value>
        </con:property>
        <con:property>
          <con:name>generatedMessage</con:name>
          <con:value><![CDATA[<?xml version="1.0"?><notify_subscriber sender="EVRY"><messageType>AgreementUpdateOwner</messageType><productType>CASA</productType><versionNo>2</versionNo><sourceApplication>AGR</sourceApplication><functionId>KFCDN</functionId><orgId>3240</orgId><financeInstituteId>423883334365999458</financeInstituteId><batchMassUpdating>3240</batchMassUpdating><userId>Z2714AR</userId><systemDate>2021-01-07</systemDate><dateTime>2021-01-07T15:51:38</dateTime><originatingSourceApplication>INTERNALIAG</originatingSourceApplication><messageTypeDataString><keyFields><customerNumber>19095908309</customerNumber><customerIntId>82898311000</customerIntId><accountNumber>32400414598</accountNumber><IBAN>NO5232400414598</IBAN></keyFields><supplementaryDataString><productType>CASA</productType><productIntId>977862086120016278</productIntId><agreementValidFromDate>2022-08-04</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate><agreementOld><agreementIntId>279196109761784856</agreementIntId><customerIntId>82898311000</customerIntId><endDate>2022-08-04</endDate><endTime>09:10:34</endTime></agreementOld><agreementNew><agreementIntId>281287267411164675</agreementIntId><customerIntId>82898311000</customerIntId><agreementValidFromDate>2022-08-04</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate><transactionLogTs/></agreementNew></supplementaryDataString></messageTypeDataString></notify_subscriber>]]></con:value>
        </con:property>
        <con:property>
          <con:name>batchMode</con:name>
          <con:value>N</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="deleteCIGRoleDataFromPWH" id="37dd1a0f-f56d-4105-9392-7989fdf21682">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP) (HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>delete from AUTH_ROLEDATA_CIG where accountnumber in ('${Properties#accountNumber}')</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="deleteCIGAccountDataFromPWH" id="5321842d-84c6-4af0-9f14-2377f836f8ab">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP) (HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>delete from AUTH_ACCOUNTDATA_CIG where ACCOUNTNUMBER in ('${Properties#accountNumber}')</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="deleteCIGCustomerDataFromPWH" id="b26c0e63-ab40-4f70-a011-473c4582c7fc">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP) (HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>delete from AUTH_CUSTOMERDATA_CIG where CUSTOMERNUMBER in ('${Properties#customerNumber}')</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="pushMessageToMQ" id="9f7c70a3-617e-4029-86b3-1910dc32cc7c">
    <con:settings/>
    <con:config>
      <script>import MQMessageUtils;

// Set MQ properties
def mQQueuemanager =context.expand( '${#Project#mqManager}' )
def mQHostName = context.expand( '${#Project#mqHostname}' )
def int mQPort = context.expand( '${#Project#mqPort}' ) as Integer
def mQChannelAuth = context.expand( '${#Project#mqChannelAuth}' )
def mQMessageQueueSend = context.expand( '${#Project#receiveQNotifySubsOnline}' )
def messageType = context.expand( '${Properties#messageType}' )
def messageToSend = context.expand( '${Properties#template_message}' )
context.testCase.getTestStepByName("Properties").setPropertyValue("generatedMessage",messageToSend)

MQMessageUtils mqMessageUtils = new MQMessageUtils(mQQueuemanager,mQHostName,mQPort,mQChannelAuth,log);
// Send Message to MQ
log.info "messageToSend ->  $messageToSend"
def sendingResult = "Message Sent :" + mqMessageUtils.sendMessage(mQMessageQueueSend,messageToSend)

return "messageToSend ->  $messageToSend \n Message Sent : \t" + mqMessageUtils.sendMessage(mQMessageQueueSend,messageToSend) +  " ; to mq : "+mQMessageQueueSend</script>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="checkAnnouncementTable" id="ff47830d-ff3d-4a74-953b-ad47da3c4100">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP) (HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>select * from PWH_AUTH_COREANNOUNCEMENT
order by CREATED_TIME
fetch first 2 rows only</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="checkCIGTables" id="b5935eda-d457-41c3-bc5e-1a583262918a">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP) (HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>select * from AUTH_CUSTOMERDATA_CIG cigc
left outer join AUTH_ROLEDATA_CIG cigr on cigr.CUSTOMERNUMBER=cigc.CUSTOMERNUMBER
left outer join AUTH_ACCOUNTDATA_CIG ciga on cigr.accountnumber=ciga.accountnumber
where cigr.CUSTOMERNUMBER in ('${Properties#customerNumber}')
and cigr.ACCOUNTNUMBER in ('${Properties#accountNumber}')</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>messageType</con:name>
      <con:value>AgreementCreate</con:value>
    </con:property>
    <con:property>
      <con:name>orgId</con:name>
      <con:value>3240</con:value>
    </con:property>
    <con:property>
      <con:name>customerNumber</con:name>
      <con:value>19095908309</con:value>
    </con:property>
    <con:property>
      <con:name>customerIntId</con:name>
      <con:value>82898311000</con:value>
    </con:property>
    <con:property>
      <con:name>accountNumber</con:name>
      <con:value>32400414598</con:value>
    </con:property>
    <con:property>
      <con:name>IBAN</con:name>
      <con:value>NO5232400414598</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
</con:testCase>
