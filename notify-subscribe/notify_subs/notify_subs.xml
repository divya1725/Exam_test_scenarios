<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="d90c8189-feb8-43b8-b3c3-c1f121a69020" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="notify_subs" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="d90c8189-feb8-43b8-b3c3-c1f121a69020fileName">notify_subs</con:setting>
  </con:settings>
  <con:testStep type="properties" name="Properties" id="4cca829a-0671-4440-8454-c1aab19a3c91">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>messageType</con:name>
          <con:value>AgreementCreate</con:value>
        </con:property>
        <con:property>
          <con:name>orgId</con:name>
          <con:value>3240</con:value>
        </con:property>
        <con:property>
          <con:name>customerNumber</con:name>
          <con:value>19095908309</con:value>
        </con:property>
        <con:property>
          <con:name>customerIntId</con:name>
          <con:value>82898311000</con:value>
        </con:property>
        <con:property>
          <con:name>accountNumber</con:name>
          <con:value>32400414598</con:value>
        </con:property>
        <con:property>
          <con:name>IBAN</con:name>
          <con:value>NO5232400414598</con:value>
        </con:property>
        <con:property>
          <con:name>agreementCreate_sample</con:name>
          <con:value><![CDATA[<?xml version="1.0"?><notify_subscriber sender="EVRY"><messageType>${Properties#messageType}</messageType><productType>INTERNAL</productType><versionNo>2</versionNo><sourceApplication>AGR</sourceApplication><functionId>KFCDC</functionId><orgId>${Properties#orgId}</orgId><financeInstituteId>049890976193784678</financeInstituteId><batchMassUpdating>N</batchMassUpdating><userId>et0922</userId><systemDate>2020-12-01</systemDate><dateTime>2020-12-01T08:58:49</dateTime><originatingSourceApplication>INTERNALIAG</originatingSourceApplication><messageTypeDataString><agreementIntId>065069654490519200</agreementIntId><keyFields><customerNumber>${Properties#customerNumber}</customerNumber><customerIntId>${Properties#customerIntId}</customerIntId><accountNumber>${Properties#accountNumber}</accountNumber><IBAN>${Properties#IBAN}</IBAN></keyFields><supplementaryDataString><productType>INTERNAL</productType><productIntId>512481233324479047</productIntId><agreementName>transit account bban</agreementName><agreementValidFromDate>2020-12-01</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate></supplementaryDataString></messageTypeDataString></notify_subscriber>]]></con:value>
        </con:property>
        <con:property>
          <con:name>generatedMessage</con:name>
          <con:value><![CDATA[<?xml version="1.0"?><notify_subscriber sender="EVRY"><messageType>AgreementCreate</messageType><productType>INTERNAL</productType><versionNo>2</versionNo><sourceApplication>AGR</sourceApplication><functionId>KFCDC</functionId><orgId>3240</orgId><financeInstituteId>049890976193784678</financeInstituteId><batchMassUpdating>N</batchMassUpdating><userId>et0922</userId><systemDate>2020-12-01</systemDate><dateTime>2020-12-01T08:58:49</dateTime><originatingSourceApplication>INTERNALIAG</originatingSourceApplication><messageTypeDataString><agreementIntId>065069654490519200</agreementIntId><keyFields><customerNumber>19095908309</customerNumber><customerIntId>82898311000</customerIntId><accountNumber>32400414598</accountNumber><IBAN>NO5232400414598</IBAN></keyFields><supplementaryDataString><productType>INTERNAL</productType><productIntId>512481233324479047</productIntId><agreementName>transit account bban</agreementName><agreementValidFromDate>2020-12-01</agreementValidFromDate><agreementValidToDate>9999-12-31</agreementValidToDate></supplementaryDataString></messageTypeDataString></notify_subscriber>]]></con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="pushMessageToMQ" id="55825f0c-a33e-4b23-9516-042f16d95892">
    <con:settings/>
    <con:config>
      <script>import MQMessageUtils;

// Set MQ properties
def mQQueuemanager =context.expand( '${#Project#mqManager}' )
def mQHostName = context.expand( '${#Project#mqHostname}' )
def int mQPort = context.expand( '${#Project#mqPort}' ) as Integer
def mQChannelAuth = context.expand( '${#Project#mqChannelAuth}' )
def mQMessageQueueSend = context.expand( '${#Project#receiveQNotifySubsOnline}' )
def messageType = context.expand( '${Properties#messageType}' )
def messageToSend = context.expand( '${Properties#agreementCreate_sample}' )
context.testCase.getTestStepByName("Properties").setPropertyValue("generatedMessage",messageToSend)

MQMessageUtils mqMessageUtils = new MQMessageUtils(mQQueuemanager,mQHostName,mQPort,mQChannelAuth,log);
// Send Message to MQ
log.info "messageToSend ->  $messageToSend"
def sendingResult = "Message Sent :" + mqMessageUtils.sendMessage(mQMessageQueueSend,messageToSend)

return "messageToSend ->  $messageToSend \n Message Sent : \t" + mqMessageUtils.sendMessage(mQMessageQueueSend,messageToSend) +  "to mq : "+mQMessageQueueSend</script>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>messageType</con:name>
      <con:value>AgreementCreate</con:value>
    </con:property>
    <con:property>
      <con:name>orgId</con:name>
      <con:value>3240</con:value>
    </con:property>
    <con:property>
      <con:name>customerNumber</con:name>
      <con:value>19095908309</con:value>
    </con:property>
    <con:property>
      <con:name>customerIntId</con:name>
      <con:value>82898311000</con:value>
    </con:property>
    <con:property>
      <con:name>accountNumber</con:name>
      <con:value>32400414598</con:value>
    </con:property>
    <con:property>
      <con:name>IBAN</con:name>
      <con:value>NO5232400414598</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
</con:testCase>
