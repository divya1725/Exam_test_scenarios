<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="3714d87d-ce8e-477e-8d81-44e33e4124b2" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="TEST_DATA" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="3714d87d-ce8e-477e-8d81-44e33e4124b2fileName">TEST_DATA</con:setting>
  </con:settings>
  <con:testStep type="manualTestStep" name="TEST_DATA_SELECTION" id="fe6eca6a-e400-4395-9172-9cde1c1a126f" disabled="true">
    <con:description>This test case is to fetch test data from PWH
	Take test data from V_AUTH_USERINFO.
	Set this data into PROPERTIES.
	Use this data across all the test cases used in the automation.

Users can also independently execute individual test cases with prior executing TEST_DATA step.</con:description>
    <con:settings/>
    <con:config xsi:type="con:ManualTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:expectedResult/>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="UPDATE_BANK_TO_Straks-2.0" id="504945ac-11fd-43f8-bcc6-e3e2f2852626">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWHDATA</con:dbConnectionName>
      <con:driver>${#Project#JDBCDriver}</con:driver>
      <con:connectionString>${#Project#PWHDbString}</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>UPDATE PRODUCT_FEATURE 
SET PRODUCT = 'Straks-2.0' WHERE 
INITIATORBANKID IN ('${Properties#orgid}')</con:query>
      <con:storedProcedure>false</con:storedProcedure>
      <con:assertion type="JDBC Status" id="266efb75-b6f0-4041-abb8-b71379cf3d0a" name="JDBC Status"/>
      <con:assertion type="DataAndMetadataAssertion" id="9c8147b5-ba49-4fd1-9e88-7d5fff08e637" name="Smart Assertion">
        <con:configuration xsi:type="con:DataAndMetadataAssertion">
          <con:mode>Received Data</con:mode>
          <con:elements>
            <con:path>//Results[1]/UpdateCount[1]</con:path>
            <con:element>UpdateCount</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage>&lt;Results>
   &lt;UpdateCount>1&lt;/UpdateCount>
&lt;/Results></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="httprequest" name="Clear Cache" id="026f01ce-bc46-48b6-9547-08f80a4deb07">
    <con:settings/>
    <con:config method="GET" xsi:type="con:HttpRequest" id="46aafd55-4141-4c58-b166-e029526f9a94" name="Clear Cache" postQueryString="false" mediaType="application/xml" downloadIncludedResources="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:settings>
        <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="LogRef" value="${Properties#LogRef}" xmlns="http://eviware.com/soapui/config"/></con:setting>
      </con:settings>
      <con:endpoint>http://${#Project#PIN}/pin/monitoring?action=clear_cache&amp;cacheId=productFeature</con:endpoint>
      <con:request/>
      <con:credentials>
        <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
        <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
        <con:authType>Global HTTP Settings</con:authType>
      </con:credentials>
      <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
      <con:parameters/>
      <con:environmentSpec>
        <con:entry environmentId="ea42990c-9799-4c4e-a1f8-f3a85518410e">
          <con:authProfile>Basic</con:authProfile>
          <con:username>monitoring</con:username>
          <con:password>monitoring</con:password>
          <con:preemptive>true</con:preemptive>
        </con:entry>
        <con:entry environmentId="1e081e08-b8ca-49a8-83ed-1a453bba7ec9">
          <con:authProfile>Basic</con:authProfile>
          <con:username>monitoring</con:username>
          <con:password>monitoring</con:password>
        </con:entry>
        <con:entry environmentId="9738a180-208f-4827-a639-cc08af5cdd1a">
          <con:authProfile>Basic</con:authProfile>
          <con:username>monitoring</con:username>
          <con:password>monitoring</con:password>
          <con:preemptive>true</con:preemptive>
        </con:entry>
        <con:entry environmentId="2878fbf5-10c5-4f5b-958d-74c6634e6274">
          <con:authProfile>Basic</con:authProfile>
          <con:username>monitoring</con:username>
          <con:password>monitoring</con:password>
        </con:entry>
      </con:environmentSpec>
    </con:config>
  </con:testStep>
  <con:testStep type="properties" name="Properties" id="40bd53b1-f942-42b5-85c1-2b581188071a">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>Test Data From</con:name>
          <con:value>G-D2</con:value>
        </con:property>
        <con:property>
          <con:name>orgid</con:name>
          <con:value>3625</con:value>
        </con:property>
        <con:property>
          <con:name>credentials</con:name>
          <con:value>03110013010400445gft3cRnCLPWWq8xlQ7RTFGToxV2ar6TuwU6Z3UeBuPGOtIilCde6ooP8yOg24ZLxjrSIpQnXuqKD/MjoNuGS8Rw4mB1dHsCbdEPzxdSUScEOatyHX5qqpMbWdg9sXd9OjrSIpQnXuqKD/MjoNuGS8Y60iKUJ17qig/zI6DbhkvGOtIilCde6ooP8yOg24ZLxjrSIpQnXuqKD/MjoNuGS8VQ+cJDNKa9VYZxw7KIYbHB8cLeYBVPv9zeRx72/R0ziZwLpDJ3GXhXq1GEwqQfSKYJ2tYpapZTAlGka5wOfU82PaZrpEiGpF2MtWFUNZT5mGde8AMKM7YjZLq7bNqLJkX2jWnq8NpJv3mKcnhxevntuGj+LNVvt9Yd3A4XTDgHK8R22vZAGljeNQwWelwnd9cTDrDHgPSubME8PWzJvEoc=</con:value>
        </con:property>
        <con:property>
          <con:name>SourceApplication</con:name>
          <con:value>EVRYINT</con:value>
        </con:property>
        <con:property>
          <con:name>MarketType</con:name>
          <con:value>PM</con:value>
        </con:property>
        <con:property>
          <con:name>PaymentChannel</con:name>
          <con:value>INT</con:value>
        </con:property>
        <con:property>
          <con:name>SelfService</con:name>
          <con:value>true</con:value>
        </con:property>
        <con:property>
          <con:name>Employee</con:name>
          <con:value>E600685</con:value>
        </con:property>
        <con:property>
          <con:name>AgreementId</con:name>
          <con:value>18128311250</con:value>
        </con:property>
        <con:property>
          <con:name>Customerid</con:name>
          <con:value>18128311250</con:value>
        </con:property>
        <con:property>
          <con:name>Userid</con:name>
          <con:value>18128311250</con:value>
        </con:property>
        <con:property>
          <con:name>DebitAccount</con:name>
          <con:value>36245288462</con:value>
        </con:property>
        <con:property>
          <con:name>DebitAcntCcy</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>DebtorAgentBic</con:name>
          <con:value>SPTRNO22XXX</con:value>
        </con:property>
        <con:property>
          <con:name>InstrAmount</con:name>
          <con:value>0.19</con:value>
        </con:property>
        <con:property>
          <con:name>CreditAccount</con:name>
          <con:value>42021430581</con:value>
        </con:property>
        <con:property>
          <con:name>LogRef</con:name>
          <con:value>${= java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern('dMMyyHHmmss'))}</con:value>
        </con:property>
        <con:property>
          <con:name>ReqExnDate</con:name>
          <con:value>${= java.time.LocalDate.now()}</con:value>
        </con:property>
        <con:property>
          <con:name>paymentcontext</con:name>
          <con:value>{"items":{"PaymentChannel":"ITR","SelfService":"false","LogRef":"${Properties#LogRef}"}}</con:value>
        </con:property>
        <con:property>
          <con:name>USERSESSION</con:name>
          <con:value>{"authLevel":"2", "bankOrgID":"${Properties#orgid}", "client":{"ip":"127.0.0.1","userAgent":"soapUI"}, "sessionID":"ipY-R_OLbu50WpfCfQKOCO_", "userID":"${Properties#Employee}"}</con:value>
        </con:property>
        <con:property>
          <con:name>SECURITYTOKEN</con:name>
          <con:value>{"tokenType": "EvrySo", "token": "${Properties#credentials}"}</con:value>
        </con:property>
        <con:property>
          <con:name>TppId</con:name>
          <con:value>PSDNO-FSA-918713867</con:value>
        </con:property>
        <con:property>
          <con:name>TppName</con:name>
          <con:value>VIPPS AS</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="V_AUTH_USERINFO" id="a6843760-aa86-4bde-8423-eedc1e068f53">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWHDATA</con:dbConnectionName>
      <con:driver>${#Project#JDBCDriver}</con:driver>
      <con:connectionString>${#Project#PWHDbString}</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>SELECT USERID,ACCOUNTNUMBER,CURRENCYCODE
FROM V_AUTH_USERINFO WHERE
BANKORGID='${Properties#orgid}'
AND MARKETTYPE='${Properties#MarketType}'
AND CHANNEL = '${Properties#PaymentChannel}'
AND ACCOUNTROLENAME IN ('Register')
FETCH FIRST 1 ROWS ONLY</con:query>
      <con:assertion type="JDBC Status" id="266efb75-b6f0-4041-abb8-b71379cf3d0a" name="JDBC Status"/>
      <con:assertion type="DataAndMetadataAssertion" id="9c8147b5-ba49-4fd1-9e88-7d5fff08e637" name="Smart Assertion">
        <con:configuration xsi:type="con:DataAndMetadataAssertion">
          <con:mode>Received Data</con:mode>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/@fetchSize</con:path>
            <con:element>@fetchSize</con:element>
            <con:operatorId>8</con:operatorId>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>true</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/@rowNumber</con:path>
            <con:element>@rowNumber</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/USERID[1]</con:path>
            <con:element>USERID</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>19054210828</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTNUMBER[1]</con:path>
            <con:element>ACCOUNTNUMBER</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>42024493606</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTTYPENAME[1]</con:path>
            <con:element>ACCOUNTTYPENAME</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>CoreAccount</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/CURRENCYCODE[1]</con:path>
            <con:element>CURRENCYCODE</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>NOK</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:path>//Results[1]/ResultSet[1]/Row[1]/ACCOUNTROLENAME[1]</con:path>
            <con:element>ACCOUNTROLENAME</con:element>
            <con:operatorId>1</con:operatorId>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Register</con:expectedValue>
            <con:caseSensitive>false</con:caseSensitive>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage><![CDATA[<Results>
   <ResultSet fetchSize="10">
      <Row rowNumber="1">
         <USERID>19054210828</USERID>
         <ACCOUNTNUMBER>42024493606</ACCOUNTNUMBER>
         <ACCOUNTTYPENAME>CoreAccount</ACCOUNTTYPENAME>
         <CURRENCYCODE>NOK</CURRENCYCODE>
         <ACCOUNTROLENAME>Register</ACCOUNTROLENAME>
      </Row>
   </ResultSet>
</Results>]]></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="SET_TEST_DATA" id="529549f0-289c-4767-9fa5-10756bd83a3e">
    <con:settings/>
    <con:config>
      <script>String environment = context.testCase.testSuite.project.getActiveEnvironment().getName();
String userid = context.expand( '${V_AUTH_USERINFO#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/USERID[1]}' );
String account = context.expand( '${V_AUTH_USERINFO#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/ACCOUNTNUMBER[1]}' );
String currency = context.expand( '${V_AUTH_USERINFO#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/CURRENCYCODE[1]}' );
userid= userid.toString().replaceAll("[^a-zA-Z0-9]+","");
account= account.toString().replaceAll("[^a-zA-Z0-9]+","");
currency= currency.toString().replaceAll("[^a-zA-Z0-9]+","");

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Customerid",userid);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Userid",userid);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("AgreementId",userid);

testRunner.testCase.getTestStepByName("Properties").setPropertyValue("DebitAccount",account);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("DebitAcntCcy",currency);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Test Data From",environment);</script>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
</con:testCase>
