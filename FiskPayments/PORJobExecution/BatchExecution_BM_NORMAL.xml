<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="3623c115-8561-4fc5-b1aa-2c84b0a5b325" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="BatchExecution_BM_NORMAL" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="3623c115-8561-4fc5-b1aa-2c84b0a5b325fileName">BatchExecution_BM_NORMAL</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="properties" name="Properties" id="53869884-c063-49a3-977f-33d5c945f754">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>POR1OutputFile</con:name>
          <con:value>por-reservation_4701_20210112140807814.xml</con:value>
        </con:property>
        <con:property>
          <con:name>FTSLastModifiedDate</con:name>
          <con:value>1610456994</con:value>
        </con:property>
        <con:property>
          <con:name>FTSResponseFile</con:name>
          <con:value>pen_FILE_OF_RESERVATIONS_210112140844700.xml</con:value>
        </con:property>
        <con:property>
          <con:name>FTS_Destination_Masked</con:name>
          <con:value>FTS_V</con:value>
        </con:property>
        <con:property>
          <con:name>POR1LastModifiedTime</con:name>
          <con:value>1610456890</con:value>
        </con:property>
        <con:property>
          <con:name>marketType</con:name>
          <con:value>BM</con:value>
        </con:property>
        <con:property>
          <con:name>jobRunType</con:name>
          <con:value>NORMAL</con:value>
        </con:property>
        <con:property>
          <con:name>CapitalOutputFile</con:name>
          <con:value>por-capital_4701_20210112141107591.xml</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="UpdateDueDateTransactions" id="a0098ece-e64a-43b5-a4b8-42253194ae29">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:pwhdata/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d4)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>Update TRANSACTIONS 
set REQUESTEDEXECUTIONDATE = '${= java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern("dd-MMM-yy")).toString()}',
RELEASEDATE = '${= java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern("dd-MMM-yy")).toString()}' 
where 
PAYMENT_REF in (${#[Fisk Testcases]#transactionsIdsBM})</con:query>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="setPORSchemaFree" id="62c3717a-edef-4980-94b8-9fc59922d9ed">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>Database</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:pwhdata/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d4)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>update CTL_BATCH_RUN_SCHEMA set STATUS = 'FREE' where SCHEMA_NAME in (select SCHEMA_NAME from CTL_BATCH_RUN_SCHEMA  order by START_TIMESTAMP asc fetch first 1 rows only)</con:query>
      <con:assertion type="JDBC Status" id="5a4aec68-6ce1-4ea9-a6c5-9c6aba3cfedd" name="JDBC Status"/>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="PORBatchJobRun" id="36ebbec9-f50f-485f-9adf-1385af875b61">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#EBSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def marketType = context.expand( '${Properties#marketType}' )
marketType = marketType.toUpperCase()
def jobRunType = context.expand( '${Properties#jobRunType}' )
jobRunType = jobRunType.toUpperCase()

String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)
log.info ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort))

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Running the batch...."

def nextDate =  new Date() ;
nextDate =java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern('yyyy/MM/dd'))
//nextDate = nextDate.format("yyyy/MM/dd")
def runId = new Date()
//runId = runId.format("YYYY-MM-dd'T'HH:mm:ss.SSSSSSSSS")
runId=java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern("YYYY-MM-dd'T'HH:mm:ss.SSSSSSSSS"))

//String shParameter = "pwhFraudRevalidationProcess.sh classpath:spring/pwh-fraud-revalidation-job-batch-context.xml pwhFraudRevalidationProcess paymentStatuses=\"RFDD,LAFU,TERE\" releaseDate=${nextDate} banksInProcess=\"4201\" 2>&amp;1"
String shParameter = "porCommonReservationLauncher.sh processLine=ADV_CREDIT_RESV_RTS paymentStatuses=RFDD,LAFU releaseDate=${nextDate} jobRunType=$jobRunType porType=CompletePOR banksInProcess=4701 marketType=$marketType runId=$runId"
log.info "shParameter-->$shParameter"
String CommandOutPut = ServerConnect.execBatchCommand(env , "pin" ,shParameter)	


log.info "shParameter : "+shParameter
log.info "CommandOutput returned-->" + CommandOutPut
ServerConnect.closeConnection()
def porSuccessMessage1 = 'POR reservation job completed'
def porSuccessMessage2 ='POR reservation job went OK'

assert (CommandOutPut.trim() != "" &amp;&amp; (CommandOutPut.contains(porSuccessMessage1) ||  CommandOutPut.contains(porSuccessMessage2))), "CommandLine OutPut having error!!, Executed command :" + CommandOutPut

String POR1LastModifiedTime = System.currentTimeMillis().toString().substring(0,10)
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("POR1LastModifiedTime","$POR1LastModifiedTime")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="Delay0" id="c51d963b-5156-443a-bb57-05b4cbb5d236">
    <con:settings/>
    <con:config>
      <delay>10000</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="DownloadPOR1OutputFile" id="6741aad1-a6e8-4163-b6ab-97a891e31ffe">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#EBSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def projectPath = testRunner.getTestCase().testSuite.project.getPath()
def marketType = context.expand( '${Properties#marketType}' )
marketType = marketType.toLowerCase()
String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

//String str = testRunner.testCase.getTestStepByName("Properties").getPropertyValue("POR1LastModifiedTime")
//int POR1LastModifiedTime = Integer.parseInt(str)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Downloading...."

String source = "/ebs/$env/pin/data/fts/reservation/out/$marketType"
String destination = projectPath + File.separator + "data"

String POR1OutputFile = ""
try{
	POR1OutputFile = ServerConnect.getLatestFile(source,destination,0,log)
}catch(Exception ex){
	log.info "Error:" + ex
}

log.info "Uploading success!!  POR1OutputFile is $POR1OutputFile "
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("POR1OutputFile", POR1OutputFile)

ServerConnect.closeConnection()

assert POR1OutputFile != "", "FTS POR1OutputFile not created"</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UploadToFTS" id="1a0a83df-2abd-43e8-90f9-9ec0f02e5f15">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#FTSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def projectPath = testRunner.getTestCase().testSuite.project.getPath()

String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Uploading to FTS server...."

String sourceFolder = projectPath + File.separator + "data"
String destination = "/tn/t2/fts/data/in/pe/earmarking/pen"
File Localfolder = new File(sourceFolder)
def latestFile = ""

//Get latestModified file from "ProjectPath//data// "folder

//long lastModified = 0
//Localfolder.listFiles().each{ file ->
//if (file.lastModified() > lastModified )
//	{
//		lastModified = file.lastModified()
//		latestFile = file.absolutePath
//	}
//}
//
//log.info "latestFile:" + latestFile
latestFile = sourceFolder + File.separator  + testRunner.testCase.getTestStepByName("Properties").getPropertyValue("POR1OutputFile")

try{
	ServerConnect.uploadFile(latestFile,destination)
}catch(Exception ex){
	log.info "Error:" + ex
}
String FTSLastModifiedDate = System.currentTimeMillis().toString().substring(0,10)
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("FTSLastModifiedDate","$FTSLastModifiedDate")

log.info "Uploading success!!"
ServerConnect.closeConnection()</script>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="Delay" id="2d7872cc-ce8e-4b8a-8cc0-cc870d4c1894">
    <con:settings/>
    <con:config>
      <delay>10000</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="56839071-2c0f-4258-9295-a61251d4c6de" name="CAUCStartJob - RECEIVE_RESERVATION">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>CAUCJobSoapBinding</con:interface>
      <con:operation>CAUCStartJob</con:operation>
      <con:request name="CAUCStartJob - RECEIVE_RESERVATION" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" id="837df0b1-bb1c-4bb3-b011-975f26c8c97d" defaultOutgoingWss="" defaultIncomingWss="">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://${#Project#FTS_Masked_Batch_V}/fts/services/CAUCJobService</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v10">
   <soapenv:Header>
      <wsc:AutHeader>
         <wsc:SourceApplication>CAUC_TEST</wsc:SourceApplication>
         <wsc:DestinationApplication>${Properties#FTS_Destination_Masked}</wsc:DestinationApplication>
         <wsc:Function>RECEIVE_RESERVATION</wsc:Function>
         <wsc:ClientContext>
            <wsc:userid>CAUC</wsc:userid>
            <wsc:credentials>CAUC</wsc:credentials>
            <wsc:channel>NBA</wsc:channel>
            <wsc:orgid>1802</wsc:orgid>
            <wsc:orgunit>1802</wsc:orgunit>
            <wsc:customerid>CAUC</wsc:customerid>
            <wsc:ip>192.168.1.1</wsc:ip>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <CAUCStartJob xmlns="http://edb.com/ws/cauc">
         <Command>RECEIVE_RESERVATION</Command>
         <CommandLine>-JobId 1234 -Destination pen/ -ReturnUrl NO_REPLY</CommandLine>
      </CAUCStartJob>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="SOAP Response" id="0b9c26bf-0756-4346-9574-dae202b2ae34" name="SOAP Response"/>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:jmsPropertyConfig/>
        <con:wsaConfig mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="Delay2" id="2dd70167-e7b3-41b8-b18f-3dc7582c5ec8">
    <con:settings/>
    <con:config>
      <delay>61000</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="DownloadFTSResponseFile" id="d1c13509-fa81-4980-86e7-5accfcf042c6">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#FTSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def projectPath = testRunner.getTestCase().testSuite.project.getPath()

String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

String str = testRunner.testCase.getTestStepByName("Properties").getPropertyValue("FTSLastModifiedDate")
int FTSLastModifiedDate = Integer.parseInt(str)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Downloading from FTS!!...."

String source = "/tn/t2/fts/data/out/pe/earmarking/pen"
String destination = projectPath + File.separator + "data"

String FTSResponseFile = ""
try{
	FTSResponseFile = ServerConnect.getLatestFile(source,destination,FTSLastModifiedDate,log)
}catch(Exception ex){
	log.info "Error:" + ex
}

log.info "Downloading success!!  FTSResponseFile is $FTSResponseFile "
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("FTSResponseFile", FTSResponseFile)

ServerConnect.closeConnection()

assert FTSResponseFile != "", "FTS ResponseFile not created"</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="CopyFTSResponseToEBS" id="a6e6028a-ea41-48a6-9a2f-bc126f14e4ed">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#EBSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
strUsername = strUsername.toLowerCase()
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def projectPath = testRunner.getTestCase().testSuite.project.getPath()

String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Uploading to EBS  server...."

String sourceFolder = projectPath + File.separator + "data"
String destination = "/home/$strUsername"
File Localfolder = new File(sourceFolder)
def latestFile = ""

//Get latestModified file from "ProjectPath//data// "folder

//long lastModified = 0
//Localfolder.listFiles().each{ file ->
//if (file.lastModified() > lastModified )
//	{
//		lastModified = file.lastModified()
//		latestFile = file.absolutePath
//	}
//}
//
//log.info "latestFile:" + latestFile
latestFile = sourceFolder + File.separator  + testRunner.testCase.getTestStepByName("Properties").getPropertyValue("FTSResponseFile")
log.info "latestFile-->" + latestFile
try{
	log.info "upload to pOR2 is " + ServerConnect.uploadFile(latestFile,destination)
}catch(Exception ex){
	log.info "Error:" + ex
}

log.info "Uploading FTS res for POR2 success!!"
ServerConnect.closeConnection()</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="CopyFileForPOR2" id="f80cbe0d-0057-4c94-b907-b334de8bd303">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#EBSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )

String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Copying file to POR2 folder...."

def por2FileName =  testRunner.testCase.getTestStepByName("Properties").getPropertyValue("FTSResponseFile")

String shParameter = "echo $strPassword | sudo -S su - pin$env -c \"cp /home/$strPassword/$por2FileName /ebs/$env/pin/pin-daemon/i1/target/fts/reservation/in/por2\""
String CommandOutPut = ServerConnect.execCommand(shParameter)		

log.info "shParameter : "+shParameter
log.info "CommandOutput returned-->" + CommandOutPut
ServerConnect.closeConnection()


String FTSLastModifiedDate = System.currentTimeMillis().toString().substring(0,10)
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("FTSLastModifiedDate","$FTSLastModifiedDate")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="Delay 3" id="5031ed55-d71b-4db5-be58-122c62ae062c">
    <con:settings/>
    <con:config>
      <delay>100000</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="FISKTransactions_HST" id="c02bdba8-7a88-4e04-bb14-42a6ce1c259b">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:pwhdata/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d4)))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>select  M.MESSAGEID,M.MESSAGEIDENTIFICATION,T.FK_PAYMENTINFOID,T.TRANSACTIONSID,T.bookinglevel,T.REQUESTEDEXECUTIONDATE,T.RELEASEDATE,T.TRANSFER_IN_SAME_BANK, M.INITIATORBANKID,T.FK_PROCESSINGLINEID,T.PEPROCESSINGLINE ,T.DEBETACCOUNTNO,T.PAYMENTSTATUS 
from HST_TRANSACTIONS T , Message M , PAYMENTINFO P  where 
M.messageid = P.FK_messageId and 
P.PAYMENTINFOID = T.FK_PAYMENTINFOID and
T.TRANSACTIONSID in
(${#[Fisk Testcases]#transactionsIdsBM})</con:query>
      <con:assertion type="JDBC Status" id="df3bb398-80de-48f6-b2b8-26bd0c3c9e0d" name="JDBC Status"/>
      <con:assertion type="MessageContentAssertion" id="b9950731-a5d3-4213-a68d-c5d57b014ace" name="Message Content Assertion">
        <con:configuration xsi:type="con:MessageContentAssertion">
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/@fetchSize</con:xpath>
            <con:element>@fetchSize</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>10</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/@rowNumber</con:xpath>
            <con:element>@rowNumber</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MESSAGEID[1]</con:xpath>
            <con:element>MESSAGEID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>393400</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/MESSAGEIDENTIFICATION[1]</con:xpath>
            <con:element>MESSAGEIDENTIFICATION</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Exceeddays_12121052017</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/FK_PAYMENTINFOID[1]</con:xpath>
            <con:element>FK_PAYMENTINFOID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>411245</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TRANSACTIONSID[1]</con:xpath>
            <con:element>TRANSACTIONSID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>442058</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/BOOKINGLEVEL[1]</con:xpath>
            <con:element>BOOKINGLEVEL</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>B</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/REQUESTEDEXECUTIONDATE[1]</con:xpath>
            <con:element>REQUESTEDEXECUTIONDATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-01-12 00:00:00</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/RELEASEDATE[1]</con:xpath>
            <con:element>RELEASEDATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-01-12 00:00:00</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TRANSFER_IN_SAME_BANK[1]</con:xpath>
            <con:element>TRANSFER_IN_SAME_BANK</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Y</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/INITIATORBANKID[1]</con:xpath>
            <con:element>INITIATORBANKID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>4701</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/FK_PROCESSINGLINEID[1]</con:xpath>
            <con:element>FK_PROCESSINGLINEID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>54</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PEPROCESSINGLINE[1]</con:xpath>
            <con:element>PEPROCESSINGLINE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>PE_DOM_OUT</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/DEBETACCOUNTNO[1]</con:xpath>
            <con:element>DEBETACCOUNTNO</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>45800724264</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENTSTATUS[1]</con:xpath>
            <con:element>PAYMENTSTATUS</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>COMP</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/@rowNumber</con:xpath>
            <con:element>@rowNumber</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>2</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/MESSAGEID[1]</con:xpath>
            <con:element>MESSAGEID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>393406</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/MESSAGEIDENTIFICATION[1]</con:xpath>
            <con:element>MESSAGEIDENTIFICATION</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Validfalse_12121052153</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/FK_PAYMENTINFOID[1]</con:xpath>
            <con:element>FK_PAYMENTINFOID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>411251</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/TRANSACTIONSID[1]</con:xpath>
            <con:element>TRANSACTIONSID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>442064</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/BOOKINGLEVEL[1]</con:xpath>
            <con:element>BOOKINGLEVEL</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>B</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/REQUESTEDEXECUTIONDATE[1]</con:xpath>
            <con:element>REQUESTEDEXECUTIONDATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-01-12 00:00:00</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/RELEASEDATE[1]</con:xpath>
            <con:element>RELEASEDATE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>2021-01-12 00:00:00</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/TRANSFER_IN_SAME_BANK[1]</con:xpath>
            <con:element>TRANSFER_IN_SAME_BANK</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>Y</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/INITIATORBANKID[1]</con:xpath>
            <con:element>INITIATORBANKID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>4701</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/FK_PROCESSINGLINEID[1]</con:xpath>
            <con:element>FK_PROCESSINGLINEID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>54</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/PEPROCESSINGLINE[1]</con:xpath>
            <con:element>PEPROCESSINGLINE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>PE_DOM_OUT</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/DEBETACCOUNTNO[1]</con:xpath>
            <con:element>DEBETACCOUNTNO</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>45800724264</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[2]/PAYMENTSTATUS[1]</con:xpath>
            <con:element>PAYMENTSTATUS</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>COMP</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[3]/FK_PROCESSINGLINEID[1]</con:xpath>
            <con:element>FK_PROCESSINGLINEID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>54</con:expectedValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[3]/PAYMENTSTATUS[1]</con:xpath>
            <con:element>PAYMENTSTATUS</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>COMP</con:expectedValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[3]/PEPROCESSINGLINE[1]</con:xpath>
            <con:element>PEPROCESSINGLINE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>PE_DOM_OUT</con:expectedValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[3]/@rowNumber</con:xpath>
            <con:element>@rowNumber</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>3</con:expectedValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[3]/INITIATORBANKID[1]</con:xpath>
            <con:element>INITIATORBANKID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>4701</con:expectedValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage><![CDATA[<Results>
   <ResultSet fetchSize="10">
      <Row rowNumber="1">
         <MESSAGEID>393400</MESSAGEID>
         <MESSAGEIDENTIFICATION>Exceeddays_12121052017</MESSAGEIDENTIFICATION>
         <FK_PAYMENTINFOID>411245</FK_PAYMENTINFOID>
         <TRANSACTIONSID>442058</TRANSACTIONSID>
         <BOOKINGLEVEL>B</BOOKINGLEVEL>
         <REQUESTEDEXECUTIONDATE>2021-01-12 00:00:00</REQUESTEDEXECUTIONDATE>
         <RELEASEDATE>2021-01-12 00:00:00</RELEASEDATE>
         <TRANSFER_IN_SAME_BANK>Y</TRANSFER_IN_SAME_BANK>
         <INITIATORBANKID>4701</INITIATORBANKID>
         <FK_PROCESSINGLINEID>54</FK_PROCESSINGLINEID>
         <PEPROCESSINGLINE>PE_DOM_OUT</PEPROCESSINGLINE>
         <DEBETACCOUNTNO>45800724264</DEBETACCOUNTNO>
         <PAYMENTSTATUS>COMP</PAYMENTSTATUS>
      </Row>
      <Row rowNumber="2">
         <MESSAGEID>393406</MESSAGEID>
         <MESSAGEIDENTIFICATION>Validfalse_12121052153</MESSAGEIDENTIFICATION>
         <FK_PAYMENTINFOID>411251</FK_PAYMENTINFOID>
         <TRANSACTIONSID>442064</TRANSACTIONSID>
         <BOOKINGLEVEL>B</BOOKINGLEVEL>
         <REQUESTEDEXECUTIONDATE>2021-01-12 00:00:00</REQUESTEDEXECUTIONDATE>
         <RELEASEDATE>2021-01-12 00:00:00</RELEASEDATE>
         <TRANSFER_IN_SAME_BANK>Y</TRANSFER_IN_SAME_BANK>
         <INITIATORBANKID>4701</INITIATORBANKID>
         <FK_PROCESSINGLINEID>54</FK_PROCESSINGLINEID>
         <PEPROCESSINGLINE>PE_DOM_OUT</PEPROCESSINGLINE>
         <DEBETACCOUNTNO>45800724264</DEBETACCOUNTNO>
         <PAYMENTSTATUS>COMP</PAYMENTSTATUS>
      </Row>
      <Row rowNumber="3">
         <MESSAGEID>393408</MESSAGEID>
         <MESSAGEIDENTIFICATION>Validfalse_12121052209</MESSAGEIDENTIFICATION>
         <FK_PAYMENTINFOID>411253</FK_PAYMENTINFOID>
         <TRANSACTIONSID>442069</TRANSACTIONSID>
         <BOOKINGLEVEL>B</BOOKINGLEVEL>
         <REQUESTEDEXECUTIONDATE>2021-01-12 00:00:00</REQUESTEDEXECUTIONDATE>
         <RELEASEDATE>2021-01-12 00:00:00</RELEASEDATE>
         <TRANSFER_IN_SAME_BANK>Y</TRANSFER_IN_SAME_BANK>
         <INITIATORBANKID>4701</INITIATORBANKID>
         <FK_PROCESSINGLINEID>54</FK_PROCESSINGLINEID>
         <PEPROCESSINGLINE>PE_DOM_OUT</PEPROCESSINGLINE>
         <DEBETACCOUNTNO>45800724264</DEBETACCOUNTNO>
         <PAYMENTSTATUS>COMP</PAYMENTSTATUS>
      </Row>
   </ResultSet>
</Results>]]></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="CopyCapitalResponseFile" id="9680de58-4a50-4174-9fc7-d65a418c3939">
    <con:settings/>
    <con:config>
      <script>def strHost = context.expand( '${#Project#EBSHost}' )
def strUsername = context.expand( '${#Project#UserName}' )
def strPassword = context.expand( '${#Project#Password}' )
def  intPort = context.expand( '${#Project#Port}' )
def projectPath = testRunner.getTestCase().testSuite.project.getPath()
def marketType = context.expand( '${Properties#marketType}' )
marketType = marketType.toLowerCase()
String env = testRunner.testCase.testSuite.project.getActiveEnvironmentName().toLowerCase()
env = env.toString().substring(2)

String str = testRunner.testCase.getTestStepByName("Properties").getPropertyValue("FTSLastModifiedDate")
int FTSLastModifiedDate = Integer.parseInt(str)

if (!(ServerConnect.Connect(strHost ,strUsername, strPassword, Integer.parseInt(intPort)) == "PASS"))
	assert false," Failed to conenct to linux server!!"
else
 log.info "Connected to the server successfully!!"

log.info "Downloading...."

String source = "/ebs/$env/pin/pin-daemon/i1/target/fts/capital/out/$marketType"
String destination = projectPath + File.separator + "data"

String capitalOutputFile = ""
try{
	capitalOutputFile = ServerConnect.getLatestFile(source,destination,FTSLastModifiedDate,log)
}catch(Exception ex){
	log.info "Error:" + ex
}

log.info "Downloading success!!  capitalOutputFile is $capitalOutputFile "
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("CapitalOutputFile", capitalOutputFile)

ServerConnect.closeConnection()

assert capitalOutputFile != "", "FTS capitalOutputFile not created"</script>
    </con:config>
  </con:testStep>
  <con:setupScript>testCase.getTestStepByName("Properties").setPropertyValue("POR1OutputFile", "")
testCase.getTestStepByName("Properties").setPropertyValue("FTSLastModifiedDate", "")
testCase.getTestStepByName("Properties").setPropertyValue("FTSResponseFile", "")
testCase.getTestStepByName("Properties").setPropertyValue("POR1LastModifiedTime", "")</con:setupScript>
  <con:properties>
    <con:property>
      <con:name>map</con:name>
      <con:value>[a:a1, b:b2]</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>5381cf85-0f4b-4cb3-908b-fd81d738c6da</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>72ba828d-d1a7-48f8-b672-71288be2ad10</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>94085c43-2faf-427c-afc8-e1f78c1d1285</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>cdcb5c32-dac5-4bb7-b37e-e89f6dc868b2</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>f1cca34d-7c16-487f-a2bb-4a706de3531a</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>54c926c4-5073-4beb-b8b2-ba4628702ae4</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>a539de08-b666-4fe9-9636-fb9b9eabba66</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>72c9e7e6-b833-4294-abcd-6c0481b897cd</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>4f6afbce-b605-4838-a5fc-8d48dde99963</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>18f7d99a-6a92-4f29-bfbf-825cc01087fe</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>e4a54adb-f6f0-4532-9c90-3f755a97e3db</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>ce642f55-9aab-4401-9507-7846f445c6d0</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>392ae598-956c-4426-8253-543059469364</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>a0098ece-e64a-43b5-a4b8-42253194ae29</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
