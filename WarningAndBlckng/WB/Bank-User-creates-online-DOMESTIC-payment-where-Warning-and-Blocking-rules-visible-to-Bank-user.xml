<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="5e6f5e74-95b2-4334-95de-ea7c2217f9d9" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Bank User creates online DOMESTIC payment where Warning and Blocking rules visible to Bank user" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="5e6f5e74-95b2-4334-95de-ea7c2217f9d9fileName">Bank-User-creates-online-DOMESTIC-payment-where-Warning-and-Blocking-rules-visible-to-Bank-user</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="properties" name="Properties" id="64358bc4-5f1f-4239-90b8-303de848d390">
    <con:settings/>
    <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:properties>
        <con:property>
          <con:name>SourceApplication</con:name>
          <con:value>PaymentClient</con:value>
        </con:property>
        <con:property>
          <con:name>userid</con:name>
          <con:value>e212927</con:value>
        </con:property>
        <con:property>
          <con:name>customerid</con:name>
          <con:value>02105900530</con:value>
        </con:property>
        <con:property>
          <con:name>debitAccount</con:name>
          <con:value>40680105075</con:value>
        </con:property>
        <con:property>
          <con:name>DebitAcntccy</con:name>
          <con:value>NOK</con:value>
        </con:property>
        <con:property>
          <con:name>CreditAccount</con:name>
          <con:value>42010272380</con:value>
        </con:property>
        <con:property>
          <con:name>item1</con:name>
          <con:value>PaymentChannel</con:value>
        </con:property>
        <con:property>
          <con:name>value1</con:name>
          <con:value>ITR</con:value>
        </con:property>
        <con:property>
          <con:name>item3</con:name>
          <con:value>LogRef</con:value>
        </con:property>
        <con:property>
          <con:name>value3</con:name>
          <con:value>${=java.util.UUID.randomUUID().toString()}</con:value>
        </con:property>
        <con:property>
          <con:name>ReqExnDate</con:name>
          <con:value>${= java.time.LocalDateTime.now().format(java.time.format.DateTimeFormatter.ofPattern('yyyy-MM-dd'))}</con:value>
        </con:property>
        <con:property>
          <con:name>Verify_User</con:name>
          <con:value>e600685</con:value>
        </con:property>
        <con:property>
          <con:name>item4</con:name>
          <con:value>AgreementId</con:value>
        </con:property>
        <con:property>
          <con:name>value4</con:name>
          <con:value>82442</con:value>
        </con:property>
      </con:properties>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="d26cf6da-3f7e-45de-9d01-278037a0fb6d" name="PaymentCreate">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>PINSPayment_V1_10PortTypeSoap11</con:interface>
      <con:operation>PaymentCreate</con:operation>
      <con:request name="PaymentCreate" id="55319d83-08f5-4ea5-b187-369ae8a6a781">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://ald-eos-g-app02.man.cosng.net:22411/pin/services/PINSPayment_V1_10</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsc="http://edb.com/ws/WSCommon_v21" xmlns:urn="urn:pins.payment.evry.com:ws:paymentinitiation:v1_10" xmlns:urn1="urn:pins.payment.evry.com:domain:paymentinitiation:v1_10" xmlns:urn2="urn:pins.payment.evry.com:domain:sepa-complex-types:v8" xmlns:urn3="urn:pins.payment.evry.com:domain:debtor:v1_8" xmlns:urn4="urn:pins.payment.evry.com:domain:creditor:v1_8">
   <soapenv:Header>
      <wsc:AutHeader>
         <wsc:SourceApplication>${Properties#SourceApplication}</wsc:SourceApplication>
         <wsc:DestinationApplication>PAYS</wsc:DestinationApplication>
         <wsc:Function>paymentAuthorizationCreate</wsc:Function>
         <wsc:Version>1.0</wsc:Version>
         <wsc:ClientContext>
            <wsc:userid>${Properties#userid}</wsc:userid>
            <wsc:credentials>${#TestSuite#Credentials}</wsc:credentials>
            <wsc:channel>NBA</wsc:channel>
            <wsc:orgid>${#TestSuite#OrgID}</wsc:orgid>
            <!--Optional:-->
            <wsc:orgunit>${#TestSuite#OrgID}</wsc:orgunit>
            <!--Optional:-->
            <wsc:customerid>${Properties#customerid}</wsc:customerid>
            <!--Optional:-->
            <wsc:locale>en</wsc:locale>
            <wsc:ip>1.1.1.2</wsc:ip>
            <!--Zero or more repetitions:-->
            <wsc:item key="Employee" value="${Properties#userid}"/>
            <wsc:item key="SelfService" value="false"/>
            <wsc:item key="PaymentChannel" value="ITR"/>
            <wsc:item key="${Properties#item3}" value="${Properties#value3}"/>
            <wsc:item key="${Properties#item4}" value="${Properties#value4}"/>
         </wsc:ClientContext>
      </wsc:AutHeader>
   </soapenv:Header>
   <soapenv:Body>
      <urn:PaymentCreateRequest>
         <urn:paymentMessage>
            <urn1:paymentIdentification>
               <urn2:messageIdentification>${=Math.abs(new Random().nextInt() % 6000000) + 1}</urn2:messageIdentification>
               <!--Optional:-->
               <urn2:endToEndIdentification>${=Math.abs(new Random().nextInt() % 6000000) + 1}</urn2:endToEndIdentification>
            </urn1:paymentIdentification>
            <urn1:paymentInfo>
               <urn3:paymentMethod>TRF</urn3:paymentMethod>
               <!--Optional:-->
               <urn3:paymentTypeInformation>
                  <!--Optional:-->
                  <urn3:instructionPriority>NORM</urn3:instructionPriority>
                  <!--Optional:-->
                  <!--Optional:-->
                  <!--Optional:-->
                  <urn3:categoryPurpose>SUPP</urn3:categoryPurpose>
               </urn3:paymentTypeInformation>
               <!--You have a CHOICE of the next 2 items at this level-->
               <urn3:requestedExecutionDate>${Properties#ReqExnDate}</urn3:requestedExecutionDate>
               <urn3:debtorAccount>
                  <urn2:identification>${Properties#debitAccount}</urn2:identification>
                  <!--Optional:-->
                  <urn2:currency>${Properties#DebitAcntccy}</urn2:currency>
               </urn3:debtorAccount>
               <!--Optional:-->
               <!--Optional:-->
               <urn3:debtor>
                  <!--Optional:-->
                  <urn2:name>wick</urn2:name>
                  <!--Optional:-->
                  <urn2:postalAddress>
                     <!--Optional:-->
                     <urn2:addressType>ADDR</urn2:addressType>
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <urn2:country>NO</urn2:country>
                     <!--0 to 7 repetitions:-->
                  </urn2:postalAddress>
                  <!--Optional:-->
                  <!--Optional:-->
                  <!--Optional:-->
               </urn3:debtor>
               <!--Optional:-->
               <urn3:ultimateDebtor>
                  <!--Optional:-->
                  <!--Optional:-->
                  <urn2:postalAddress>
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--0 to 7 repetitions:-->
                  </urn2:postalAddress>
                  <!--Optional:-->
                  <!--Optional:-->
                  <!--Optional:-->
               </urn3:ultimateDebtor>
               <!--Optional:-->
            </urn1:paymentInfo>
            <urn1:transaction>
               <urn4:amount>
                  <!--You have a CHOICE of the next 2 items at this level-->
                  <urn2:instructedAmount currency="NOK">
                     <urn2:amount>10</urn2:amount>
                  </urn2:instructedAmount>
               </urn4:amount>
               <!--Optional:-->
               <!--Optional:-->
               <urn4:chargeBearer>DEBT</urn4:chargeBearer>
               <!--Optional:-->
               <!--Optional:-->
               <!--Optional:-->
               <!--Optional:-->
               <urn4:creditorAgent>
                  <!--Optional:-->
                  <!--Optional:-->
                  <!--Optional:-->
                  <urn2:name>Cred Name</urn2:name>
                  <urn2:postalAddress>
                     <!--Optional:-->
                     <urn2:addressType>ADDR</urn2:addressType>
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--0 to 7 repetitions:-->
                  </urn2:postalAddress>
               </urn4:creditorAgent>
               <!--Optional:-->
               <urn4:creditor>
                  <!--Optional:-->
                  <urn2:name>John</urn2:name>
                  <!--Optional:-->
                  <urn2:postalAddress>
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--Optional:-->
                     <!--0 to 7 repetitions:-->
                     <urn2:country>NO</urn2:country>
                  </urn2:postalAddress>
                  <!--Optional:-->
                  <!--Optional:-->
                  <!--Optional:-->
               </urn4:creditor>
               <!--Optional:-->
               <urn4:creditorAccount>
                  <urn2:identification>${Properties#CreditAccount}</urn2:identification>
                  <!--Optional:-->
               </urn4:creditorAccount>
               <urn1:remittanceInformationUnstructured>Testing20</urn1:remittanceInformationUnstructured>
               <!--Optional:-->
               <!--Zero or more repetitions:-->
               <!--Optional:-->
               <!--Optional:-->
               <!--Optional:-->
               <!--Optional:-->
               <!--You have a CHOICE of the next 2 items at this level-->
               <!--Optional:-->
               <!--Zero or more repetitions:-->
               <!--Optional:-->
               <!--Optional:-->
            </urn1:transaction>
            <!--Optional:-->
            <!--Optional:-->
            <!--Optional:-->
         </urn:paymentMessage>
      </urn:PaymentCreateRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Valid HTTP Status Codes" id="fc707e0e-77e5-40e5-b5bc-8914253287b3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="SOAP Fault Assertion" id="eb48473c-2e3d-4c5e-a7e6-7cd1cf563574" name="Not SOAP Fault"/>
        <con:assertion type="Schema Compliance" id="72226016-40b1-4b5d-afb6-49a4758ac3cf" name="Schema Compliance">
          <con:configuration/>
        </con:assertion>
        <con:assertion type="GroovyScriptAssertion" id="b034d820-5dbd-48aa-8583-c26df6d9cf53" name="Script Assertion">
          <con:configuration>
            <scriptText>import com.eviware.soapui.support.XmlHolder
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.TimeZone;

def path=context.expand( '${projectDir}')
String curStepName = (String)context.getCurrentStep().getLabel()

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context ) 
def response = groovyUtils.getXmlHolder(curStepName + "#Response")
def errorCode=response.getNodeValue("//*:ErrorCode");
def testCase = context.getCurrentStep().getTestCase().getLabel()
def endPoint = messageExchange.getEndpoint()

path=path+"\\results"
File dir = new File(path);
if (!dir.exists())
{
                log.info 'Creating Directory'
                dir.mkdir();
}

Date date = new Date();
SimpleDateFormat df = new SimpleDateFormat("dd-M-yyyy hh:mm:ss a zz");    
df.setTimeZone(TimeZone.getTimeZone("Europe/Oslo"));

def datetime = df.format(date)

SimpleDateFormat fn = new SimpleDateFormat("dd-M-yyyy hh_mm_ss a zz");    
def fileName = fn.format(date)

def TestCaseNumber = context.expand( '${DataSource#TC_No}' )

//log.info path 
def fout = new File(path+"\\"+testCase+" - "+curStepName+"_"+fileName+"_"+errorCode+"_"+TestCaseNumber+".txt",)


fout.write("Time Submitted		:	"+datetime+"\r\n")
fout.append("End Point Used		:	"+endPoint+"\r\n")
fout.append("Time Taken		:	"+messageExchange.timeTaken+"ms\r\n")
fout.append("Executed in test set	:	"+testCase+" - "+curStepName+"_"+fileName)
fout.append("=========================================================================================================================\r\n","UTF-8")
fout.append("                                                                                                   REQUEST\r\n\r\n","UTF-8")
fout.append(messageExchange.getRequestHeaders())
fout.append("\n\n")
fout.append(new String( messageExchange.getRequestContent() ).replace("\n","\r\n"),"UTF-8")
fout.append("\r\n\r\n","UTF-8")
fout.append("=========================================================================================================================\r\n","UTF-8")
fout.append("                                                                                                   RESPONSE\r\n\r\n","UTF-8")
fout.append(messageExchange.getResponseHeaders())
fout.append("\n\n")
fout.append(new String( messageExchange.getResponseContent() ).replace("\n","\n"),"UTF-8")
fout.append("\r\n\r\n","UTF-8")
fout.append("=========================================================================================================================\r\n","UTF-8")</scriptText>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig action="urn:pins.payment.evry.com:ws:paymentinitiation:v1_10/PINSPayment_V1_10PortType/PaymentCreateRequest" mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
        <con:environmentSpec>
          <con:entry environmentId="5e5a2bc3-5ecc-43e4-bf43-955a17e5eaa3">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="aada34ee-a663-4a6b-8e3a-f3cb55c80a51">
            <con:authProfile>No Authorization</con:authProfile>
          </con:entry>
          <con:entry environmentId="96fe7d74-1c0e-4ae4-9bb2-ce2f2d5f4a2e">
            <con:authProfile>No Authorization</con:authProfile>
          </con:entry>
          <con:entry environmentId="310cbbec-a52d-480c-9c6d-e73e6d71b1b8">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="jdbc" name="DB_TRANSACTIONS" id="1f367495-4242-4b34-831c-8fa6ff9dd99a">
    <con:settings>
      <con:setting id="prettyPrintResponse">true</con:setting>
    </con:settings>
    <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="false" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dbConnectionName>PWH</con:dbConnectionName>
      <con:driver>oracle.jdbc.driver.OracleDriver</con:driver>
      <con:connectionString>jdbc:oracle:thin:PWHDATA/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_s1_19c )))</con:connectionString>
      <con:password/>
      <con:connectionProperties/>
      <con:query>select TRANSACTIONSID,PAYMENTTYPE,PAYMENTSTATUS,WB_FLAG from TRANSACTIONS where transactionsid = '${PaymentCreate#Response#declare namespace ns4='urn:pins.payment.evry.com:domain:paymentinitiation:v1_10'; declare namespace ns2='urn:pins.payment.evry.com:ws:paymentinitiation:v1_10'; //ns2:PaymentCreateResponse[1]/ns2:paymentResult[1]/ns4:transactionId[1]}'</con:query>
      <con:storedProcedure>false</con:storedProcedure>
      <con:assertion type="MessageContentAssertion" id="01038706-2a06-49cf-b52f-0fde456b55d6" name="Message Content Assertion">
        <con:configuration xsi:type="con:MessageContentAssertion">
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/@fetchSize</con:xpath>
            <con:element>@fetchSize</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>10</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/@rowNumber</con:xpath>
            <con:element>@rowNumber</con:element>
            <con:type/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>1</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/TRANSACTIONSID[1]</con:xpath>
            <con:element>TRANSACTIONSID</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>false</con:enabled>
            <con:expectedValue>260798761</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENTTYPE[1]</con:xpath>
            <con:element>PAYMENTTYPE</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>DOMM</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/PAYMENTSTATUS[1]</con:xpath>
            <con:element>PAYMENTSTATUS</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>VALI</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:elements>
            <con:xpath>//Results[1]/ResultSet[1]/Row[1]/WB_FLAG[1]</con:xpath>
            <con:element>WB_FLAG</con:element>
            <con:type xsi:nil="true"/>
            <con:operator>=</con:operator>
            <con:enabled>true</con:enabled>
            <con:expectedValue>N</con:expectedValue>
            <con:hasValue>false</con:hasValue>
            <con:numberType>false</con:numberType>
          </con:elements>
          <con:originalMessage><![CDATA[<Results>
   <ResultSet fetchSize="10">
      <Row rowNumber="1">
         <TRANSACTIONSID>260798761</TRANSACTIONSID>
         <PAYMENTTYPE>DOMM</PAYMENTTYPE>
         <PAYMENTSTATUS>VALI</PAYMENTSTATUS>
         <WB_FLAG>N</WB_FLAG>
      </Row>
   </ResultSet>
</Results>]]></con:originalMessage>
        </con:configuration>
      </con:assertion>
      <con:properties/>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>ConnectionString</con:name>
      <con:value>jdbc:oracle:thin:pwhdata/pwh@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=ON)(FAILOVER=ON)(ADDRESS=(PROTOCOL=TCP)(HOST=dlt-exa853-scan.unix.cosng.net)(PORT=1530)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=pwh_g_d6)))</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>266c8202-58a4-4e34-9804-07e86660e5a7</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>736177c1-78d6-476a-b70a-0fff8f4bd780</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>bdc504b4-5769-4b3a-aec9-fa9089fd4fb5</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>dfa148d8-c633-4a3a-8319-437f37d940f5</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>c7b7c33c-46a9-48fc-95c3-896789ca07c9</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
